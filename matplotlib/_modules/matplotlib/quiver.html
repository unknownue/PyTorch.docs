
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>matplotlib.quiver &#8212; Matplotlib 3.3.1 documentation</title>
    <link rel="stylesheet" href="../../_static/mpl.css?v3.3.1-dirty" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/gallery.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/gallery-binder.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/gallery-dataframe.css" />
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/language_data.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="search" type="application/opensearchdescription+xml"
          title="Search within Matplotlib 3.3.1 documentation"
          href="../../_static/opensearch.xml"/>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>

    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
<link rel="top" title="Matplotlib 3.3.1 documentation" href="#" />
    <link rel="canonical" href="https://matplotlib.org/3.3.1/_modules/matplotlib/quiver.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>


<!--
<div id="annc-banner">

</div>
-->

<div style="background-color: white; text-align: left; padding: 10px 10px 15px 15px; position: relative;">
    <a href="../../index.html">
        <div style="float: left; position: absolute; width: 496px; bottom: 0; padding-bottom: 24px"><span style="float: right; color: #789; background: white">Version 3.3.1</span></div>
        <img src="../../_static/logo2_compressed.svg" height="125px" border="0" alt="matplotlib"/></a>

    <!-- The "Fork me on github" ribbon -->
    <div id="forkongithub"><a href="https://github.com/matplotlib/matplotlib">Fork me on GitHub</a></div>
    </div>

    <nav class="main-nav">
        <ul>
            <li><a href="../../users/installing.html">Installation</a></li>
            <li><a href="../../contents.html">Documentation</a></li>
            <li><a href="../../gallery/index.html">Examples</a></li>
            <li><a href="../../tutorials/index.html">Tutorials</a></li>
            <li><a href="../../devel/index.html">Contributing</a></li>
            <li class="nav-right">
                <form class="search" action="../../search.html" method="get">
                <input type="text" name="q" aria-labelledby="searchlabel" placeholder="Search"/>
                </form>
            </li>
        </ul>
     </nav>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../index.html">home</a>|&nbsp;</li>
        <li><a href="../../contents.html">contents</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../matplotlib.html" accesskey="U">matplotlib</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">matplotlib.quiver</a></li> 
      </ul>
    </div>

      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../contents.html">Documentation overview</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  <li><a href="../matplotlib.html">matplotlib</a><ul>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
</div>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for matplotlib.quiver</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Support for plotting vector fields.</span>

<span class="sd">Presently this contains Quiver and Barb. Quiver plots an arrow in the</span>
<span class="sd">direction of the vector, with the size of the arrow related to the</span>
<span class="sd">magnitude of the vector.</span>

<span class="sd">Barbs are like quiver in that they point along a vector, but</span>
<span class="sd">the magnitude of the vector is given schematically by the presence of barbs</span>
<span class="sd">or flags on the barb.</span>

<span class="sd">This will also become a home for things such as standard</span>
<span class="sd">deviation ellipses, which can and will be derived very easily from</span>
<span class="sd">the Quiver code.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">weakref</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">ma</span>

<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">cbook</span><span class="p">,</span> <span class="n">docstring</span><span class="p">,</span> <span class="n">font_manager</span>
<span class="kn">import</span> <span class="nn">matplotlib.artist</span> <span class="k">as</span> <span class="nn">martist</span>
<span class="kn">import</span> <span class="nn">matplotlib.collections</span> <span class="k">as</span> <span class="nn">mcollections</span>
<span class="kn">from</span> <span class="nn">matplotlib.patches</span> <span class="kn">import</span> <span class="n">CirclePolygon</span>
<span class="kn">import</span> <span class="nn">matplotlib.text</span> <span class="k">as</span> <span class="nn">mtext</span>
<span class="kn">import</span> <span class="nn">matplotlib.transforms</span> <span class="k">as</span> <span class="nn">transforms</span>


<span class="n">_quiver_doc</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">Plot a 2D field of arrows.</span>

<span class="s2">Call signature::</span>

<span class="s2">  quiver([X, Y], U, V, [C], **kw)</span>

<span class="s2">*X*, *Y* define the arrow locations, *U*, *V* define the arrow directions, and</span>
<span class="s2">*C* optionally sets the color.</span>

<span class="s2">**Arrow size**</span>

<span class="s2">The default settings auto-scales the length of the arrows to a reasonable size.</span>
<span class="s2">To change this behavior see the *scale* and *scale_units* parameters.</span>

<span class="s2">**Arrow shape**</span>

<span class="s2">The defaults give a slightly swept-back arrow; to make the head a</span>
<span class="s2">triangle, make *headaxislength* the same as *headlength*. To make the</span>
<span class="s2">arrow more pointed, reduce *headwidth* or increase *headlength* and</span>
<span class="s2">*headaxislength*. To make the head smaller relative to the shaft,</span>
<span class="s2">scale down all the head parameters. You will probably do best to leave</span>
<span class="s2">minshaft alone.</span>

<span class="s2">**Arrow outline**</span>

<span class="s2">*linewidths* and *edgecolors* can be used to customize the arrow</span>
<span class="s2">outlines.</span>

<span class="s2">Parameters</span>
<span class="s2">----------</span>
<span class="s2">X, Y : 1D or 2D array-like, optional</span>
<span class="s2">    The x and y coordinates of the arrow locations.</span>

<span class="s2">    If not given, they will be generated as a uniform integer meshgrid based</span>
<span class="s2">    on the dimensions of *U* and *V*.</span>

<span class="s2">    If *X* and *Y* are 1D but *U*, *V* are 2D, *X*, *Y* are expanded to 2D</span>
<span class="s2">    using ``X, Y = np.meshgrid(X, Y)``. In this case ``len(X)`` and ``len(Y)``</span>
<span class="s2">    must match the column and row dimensions of *U* and *V*.</span>

<span class="s2">U, V : 1D or 2D array-like</span>
<span class="s2">    The x and y direction components of the arrow vectors.</span>

<span class="s2">    They must have the same number of elements, matching the number of arrow</span>
<span class="s2">    locations. *U* and *V* may be masked. Only locations unmasked in</span>
<span class="s2">    *U*, *V*, and *C* will be drawn.</span>

<span class="s2">C : 1D or 2D array-like, optional</span>
<span class="s2">    Numeric data that defines the arrow colors by colormapping via *norm* and</span>
<span class="s2">    *cmap*.</span>

<span class="s2">    This does not support explicit colors. If you want to set colors directly,</span>
<span class="s2">    use *color* instead.  The size of *C* must match the number of arrow</span>
<span class="s2">    locations.</span>

<span class="s2">units : {&#39;width&#39;, &#39;height&#39;, &#39;dots&#39;, &#39;inches&#39;, &#39;x&#39;, &#39;y&#39; &#39;xy&#39;}, default: &#39;width&#39;</span>
<span class="s2">    The arrow dimensions (except for *length*) are measured in multiples of</span>
<span class="s2">    this unit.</span>

<span class="s2">    The following values are supported:</span>

<span class="s2">    - &#39;width&#39;, &#39;height&#39;: The width or height of the axis.</span>
<span class="s2">    - &#39;dots&#39;, &#39;inches&#39;: Pixels or inches based on the figure dpi.</span>
<span class="s2">    - &#39;x&#39;, &#39;y&#39;, &#39;xy&#39;: *X*, *Y* or :math:`</span><span class="se">\\</span><span class="s2">sqrt{X^2 + Y^2}` in data units.</span>

<span class="s2">    The arrows scale differently depending on the units.  For</span>
<span class="s2">    &#39;x&#39; or &#39;y&#39;, the arrows get larger as one zooms in; for other</span>
<span class="s2">    units, the arrow size is independent of the zoom state.  For</span>
<span class="s2">    &#39;width or &#39;height&#39;, the arrow size increases with the width and</span>
<span class="s2">    height of the axes, respectively, when the window is resized;</span>
<span class="s2">    for &#39;dots&#39; or &#39;inches&#39;, resizing does not change the arrows.</span>

<span class="s2">angles : {&#39;uv&#39;, &#39;xy&#39;} or array-like, default: &#39;uv&#39;</span>
<span class="s2">    Method for determining the angle of the arrows.</span>

<span class="s2">    - &#39;uv&#39;: The arrow axis aspect ratio is 1 so that</span>
<span class="s2">      if *U* == *V* the orientation of the arrow on the plot is 45 degrees</span>
<span class="s2">      counter-clockwise from the horizontal axis (positive to the right).</span>

<span class="s2">      Use this if the arrows symbolize a quantity that is not based on</span>
<span class="s2">      *X*, *Y* data coordinates.</span>

<span class="s2">    - &#39;xy&#39;: Arrows point from (x, y) to (x+u, y+v).</span>
<span class="s2">      Use this for plotting a gradient field, for example.</span>

<span class="s2">    - Alternatively, arbitrary angles may be specified explicitly as an array</span>
<span class="s2">      of values in degrees, counter-clockwise from the horizontal axis.</span>

<span class="s2">      In this case *U*, *V* is only used to determine the length of the</span>
<span class="s2">      arrows.</span>

<span class="s2">    Note: inverting a data axis will correspondingly invert the</span>
<span class="s2">    arrows only with ``angles=&#39;xy&#39;``.</span>

<span class="s2">scale : float, optional</span>
<span class="s2">    Number of data units per arrow length unit, e.g., m/s per plot width; a</span>
<span class="s2">    smaller scale parameter makes the arrow longer. Default is *None*.</span>

<span class="s2">    If *None*, a simple autoscaling algorithm is used, based on the average</span>
<span class="s2">    vector length and the number of vectors. The arrow length unit is given by</span>
<span class="s2">    the *scale_units* parameter.</span>

<span class="s2">scale_units : {&#39;width&#39;, &#39;height&#39;, &#39;dots&#39;, &#39;inches&#39;, &#39;x&#39;, &#39;y&#39;, &#39;xy&#39;}, optional</span>
<span class="s2">    If the *scale* kwarg is *None*, the arrow length unit. Default is *None*.</span>

<span class="s2">    e.g. *scale_units* is &#39;inches&#39;, *scale* is 2.0, and ``(u, v) = (1, 0)``,</span>
<span class="s2">    then the vector will be 0.5 inches long.</span>

<span class="s2">    If *scale_units* is &#39;width&#39; or &#39;height&#39;, then the vector will be half the</span>
<span class="s2">    width/height of the axes.</span>

<span class="s2">    If *scale_units* is &#39;x&#39; then the vector will be 0.5 x-axis</span>
<span class="s2">    units. To plot vectors in the x-y plane, with u and v having</span>
<span class="s2">    the same units as x and y, use</span>
<span class="s2">    ``angles=&#39;xy&#39;, scale_units=&#39;xy&#39;, scale=1``.</span>

<span class="s2">width : float, optional</span>
<span class="s2">    Shaft width in arrow units; default depends on choice of units,</span>
<span class="s2">    above, and number of vectors; a typical starting value is about</span>
<span class="s2">    0.005 times the width of the plot.</span>

<span class="s2">headwidth : float, default: 3</span>
<span class="s2">    Head width as multiple of shaft width.</span>

<span class="s2">headlength : float, default: 5</span>
<span class="s2">    Head length as multiple of shaft width.</span>

<span class="s2">headaxislength : float, default: 4.5</span>
<span class="s2">    Head length at shaft intersection.</span>

<span class="s2">minshaft : float, default: 1</span>
<span class="s2">    Length below which arrow scales, in units of head length. Do not</span>
<span class="s2">    set this to less than 1, or small arrows will look terrible!</span>

<span class="s2">minlength : float, default: 1</span>
<span class="s2">    Minimum length as a multiple of shaft width; if an arrow length</span>
<span class="s2">    is less than this, plot a dot (hexagon) of this diameter instead.</span>

<span class="s2">pivot : {&#39;tail&#39;, &#39;mid&#39;, &#39;middle&#39;, &#39;tip&#39;}, default: &#39;tail&#39;</span>
<span class="s2">    The part of the arrow that is anchored to the *X*, *Y* grid. The arrow</span>
<span class="s2">    rotates about this point.</span>

<span class="s2">    &#39;mid&#39; is a synonym for &#39;middle&#39;.</span>

<span class="s2">color : color or color sequence, optional</span>
<span class="s2">    Explicit color(s) for the arrows. If *C* has been set, *color* has no</span>
<span class="s2">    effect.</span>

<span class="s2">    This is a synonym for the `~.PolyCollection` *facecolor* parameter.</span>

<span class="s2">Other Parameters</span>
<span class="s2">----------------</span>
<span class="s2">**kwargs : `~matplotlib.collections.PolyCollection` properties, optional</span>
<span class="s2">    All other keyword arguments are passed on to `.PolyCollection`:</span>

<span class="s2">    </span><span class="si">%(PolyCollection)s</span><span class="s2"></span>

<span class="s2">See Also</span>
<span class="s2">--------</span>
<span class="s2">.Axes.quiverkey : Add a key to a quiver plot.</span>
<span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="n">docstring</span><span class="o">.</span><span class="n">interpd</span><span class="o">.</span><span class="n">params</span>


<div class="viewcode-block" id="QuiverKey"><a class="viewcode-back" href="../../api/_as_gen/matplotlib.quiver.QuiverKey.html#matplotlib.quiver.QuiverKey">[docs]</a><span class="k">class</span> <span class="nc">QuiverKey</span><span class="p">(</span><span class="n">martist</span><span class="o">.</span><span class="n">Artist</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Labelled arrow for use as a quiver plot scale key.&quot;&quot;&quot;</span>
    <span class="n">halign</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;N&#39;</span><span class="p">:</span> <span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="s1">&#39;S&#39;</span><span class="p">:</span> <span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">:</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="s1">&#39;W&#39;</span><span class="p">:</span> <span class="s1">&#39;right&#39;</span><span class="p">}</span>
    <span class="n">valign</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;N&#39;</span><span class="p">:</span> <span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="s1">&#39;S&#39;</span><span class="p">:</span> <span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">:</span> <span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="s1">&#39;W&#39;</span><span class="p">:</span> <span class="s1">&#39;center&#39;</span><span class="p">}</span>
    <span class="n">pivot</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;N&#39;</span><span class="p">:</span> <span class="s1">&#39;middle&#39;</span><span class="p">,</span> <span class="s1">&#39;S&#39;</span><span class="p">:</span> <span class="s1">&#39;middle&#39;</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">:</span> <span class="s1">&#39;tip&#39;</span><span class="p">,</span> <span class="s1">&#39;W&#39;</span><span class="p">:</span> <span class="s1">&#39;tail&#39;</span><span class="p">}</span>

<div class="viewcode-block" id="QuiverKey.__init__"><a class="viewcode-back" href="../../api/_as_gen/matplotlib.quiver.QuiverKey.html#matplotlib.quiver.QuiverKey.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Q</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">U</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span>
                 <span class="o">*</span><span class="p">,</span> <span class="n">angle</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">coordinates</span><span class="o">=</span><span class="s1">&#39;axes&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">labelsep</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
                 <span class="n">labelpos</span><span class="o">=</span><span class="s1">&#39;N&#39;</span><span class="p">,</span> <span class="n">labelcolor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fontproperties</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a key to a quiver plot.</span>

<span class="sd">        The positioning of the key depends on *X*, *Y*, *coordinates*, and</span>
<span class="sd">        *labelpos*.  If *labelpos* is &#39;N&#39; or &#39;S&#39;, *X*, *Y* give the position of</span>
<span class="sd">        the middle of the key arrow.  If *labelpos* is &#39;E&#39;, *X*, *Y* positions</span>
<span class="sd">        the head, and if *labelpos* is &#39;W&#39;, *X*, *Y* positions the tail; in</span>
<span class="sd">        either of these two cases, *X*, *Y* is somewhere in the middle of the</span>
<span class="sd">        arrow+label key object.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        Q : `matplotlib.quiver.Quiver`</span>
<span class="sd">            A `.Quiver` object as returned by a call to `~.Axes.quiver()`.</span>
<span class="sd">        X, Y : float</span>
<span class="sd">            The location of the key.</span>
<span class="sd">        U : float</span>
<span class="sd">            The length of the key.</span>
<span class="sd">        label : str</span>
<span class="sd">            The key label (e.g., length and units of the key).</span>
<span class="sd">        angle : float, default: 0</span>
<span class="sd">            The angle of the key arrow, in degrees anti-clockwise from the</span>
<span class="sd">            x-axis.</span>
<span class="sd">        coordinates : {&#39;axes&#39;, &#39;figure&#39;, &#39;data&#39;, &#39;inches&#39;}, default: &#39;axes&#39;</span>
<span class="sd">            Coordinate system and units for *X*, *Y*: &#39;axes&#39; and &#39;figure&#39; are</span>
<span class="sd">            normalized coordinate systems with (0, 0) in the lower left and</span>
<span class="sd">            (1, 1) in the upper right; &#39;data&#39; are the axes data coordinates</span>
<span class="sd">            (used for the locations of the vectors in the quiver plot itself);</span>
<span class="sd">            &#39;inches&#39; is position in the figure in inches, with (0, 0) at the</span>
<span class="sd">            lower left corner.</span>
<span class="sd">        color : color</span>
<span class="sd">            Overrides face and edge colors from *Q*.</span>
<span class="sd">        labelpos : {&#39;N&#39;, &#39;S&#39;, &#39;E&#39;, &#39;W&#39;}</span>
<span class="sd">            Position the label above, below, to the right, to the left of the</span>
<span class="sd">            arrow, respectively.</span>
<span class="sd">        labelsep : float, default: 0.1</span>
<span class="sd">            Distance in inches between the arrow and the label.</span>
<span class="sd">        labelcolor : color, default: :rc:`text.color`</span>
<span class="sd">            Label color.</span>
<span class="sd">        fontproperties : dict, optional</span>
<span class="sd">            A dictionary with keyword arguments accepted by the</span>
<span class="sd">            `~matplotlib.font_manager.FontProperties` initializer:</span>
<span class="sd">            *family*, *style*, *variant*, *size*, *weight*.</span>
<span class="sd">        **kwargs</span>
<span class="sd">            Any additional keyword arguments are used to override vector</span>
<span class="sd">            properties taken from *Q*.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">martist</span><span class="o">.</span><span class="n">Artist</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Q</span> <span class="o">=</span> <span class="n">Q</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="o">=</span> <span class="n">X</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Y</span> <span class="o">=</span> <span class="n">Y</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">U</span> <span class="o">=</span> <span class="n">U</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">angle</span> <span class="o">=</span> <span class="n">angle</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coord</span> <span class="o">=</span> <span class="n">coordinates</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">color</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">label</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_labelsep_inches</span> <span class="o">=</span> <span class="n">labelsep</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labelsep</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_labelsep_inches</span> <span class="o">*</span> <span class="n">Q</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">dpi</span><span class="p">)</span>

        <span class="c1"># try to prevent closure over the real self</span>
        <span class="n">weak_self</span> <span class="o">=</span> <span class="n">weakref</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">on_dpi_change</span><span class="p">(</span><span class="n">fig</span><span class="p">):</span>
            <span class="n">self_weakref</span> <span class="o">=</span> <span class="n">weak_self</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">self_weakref</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">self_weakref</span><span class="o">.</span><span class="n">labelsep</span> <span class="o">=</span> <span class="n">self_weakref</span><span class="o">.</span><span class="n">_labelsep_inches</span> <span class="o">*</span> <span class="n">fig</span><span class="o">.</span><span class="n">dpi</span>
                <span class="c1"># simple brute force update works because _init is called at</span>
                <span class="c1"># the start of draw.</span>
                <span class="n">self_weakref</span><span class="o">.</span><span class="n">_initialized</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_cid</span> <span class="o">=</span> <span class="n">Q</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="s1">&#39;dpi_changed&#39;</span><span class="p">,</span> <span class="n">on_dpi_change</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">labelpos</span> <span class="o">=</span> <span class="n">labelpos</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labelcolor</span> <span class="o">=</span> <span class="n">labelcolor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fontproperties</span> <span class="o">=</span> <span class="n">fontproperties</span> <span class="ow">or</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kw</span> <span class="o">=</span> <span class="n">kw</span>
        <span class="n">_fp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fontproperties</span>
        <span class="c1"># boxprops = dict(facecolor=&#39;red&#39;)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">mtext</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span>
            <span class="n">text</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>  <span class="c1"># bbox=boxprops,</span>
            <span class="n">horizontalalignment</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">halign</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">labelpos</span><span class="p">],</span>
            <span class="n">verticalalignment</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">valign</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">labelpos</span><span class="p">],</span>
            <span class="n">fontproperties</span><span class="o">=</span><span class="n">font_manager</span><span class="o">.</span><span class="n">FontProperties</span><span class="o">.</span><span class="n">_from_any</span><span class="p">(</span><span class="n">_fp</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">labelcolor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labelcolor</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_initialized</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zorder</span> <span class="o">=</span> <span class="n">Q</span><span class="o">.</span><span class="n">zorder</span> <span class="o">+</span> <span class="mf">0.1</span></div>

<div class="viewcode-block" id="QuiverKey.remove"><a class="viewcode-back" href="../../api/_as_gen/matplotlib.quiver.QuiverKey.html#matplotlib.quiver.QuiverKey.remove">[docs]</a>    <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># docstring inherited</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">disconnect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cid</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cid</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>  <span class="c1"># pass the remove call up the stack</span></div>

    <span class="k">def</span> <span class="nf">_init</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="kc">True</span><span class="p">:</span>  <span class="c1"># not self._initialized:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="o">.</span><span class="n">_initialized</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="o">.</span><span class="n">_init</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_transform</span><span class="p">()</span>
            <span class="k">with</span> <span class="n">cbook</span><span class="o">.</span><span class="n">_setattr_cm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">,</span> <span class="n">pivot</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pivot</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">labelpos</span><span class="p">],</span>
                                   <span class="c1"># Hack: save and restore the Umask</span>
                                   <span class="n">Umask</span><span class="o">=</span><span class="n">ma</span><span class="o">.</span><span class="n">nomask</span><span class="p">):</span>
                <span class="n">u</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">U</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">angle</span><span class="p">))</span>
                <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">U</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">angle</span><span class="p">))</span>
                <span class="n">angle</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="o">.</span><span class="n">angles</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="o">.</span><span class="n">angles</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
                         <span class="k">else</span> <span class="s1">&#39;uv&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">verts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="o">.</span><span class="n">_make_verts</span><span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">u</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">v</span><span class="p">]),</span> <span class="n">angle</span><span class="p">)</span>
            <span class="n">kw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="o">.</span><span class="n">polykw</span>
            <span class="n">kw</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kw</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vector</span> <span class="o">=</span> <span class="n">mcollections</span><span class="o">.</span><span class="n">PolyCollection</span><span class="p">(</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">verts</span><span class="p">,</span>
                                        <span class="n">offsets</span><span class="o">=</span><span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Y</span><span class="p">)],</span>
                                        <span class="n">transOffset</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_transform</span><span class="p">(),</span>
                                        <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">color</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">vector</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vector</span><span class="o">.</span><span class="n">set_transform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="o">.</span><span class="n">get_transform</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vector</span><span class="o">.</span><span class="n">set_figure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_figure</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_initialized</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">_text_x</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">labelpos</span> <span class="o">==</span> <span class="s1">&#39;E&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">labelsep</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">labelpos</span> <span class="o">==</span> <span class="s1">&#39;W&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">x</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">labelsep</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">x</span>

    <span class="k">def</span> <span class="nf">_text_y</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">labelpos</span> <span class="o">==</span> <span class="s1">&#39;N&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">y</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">labelsep</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">labelpos</span> <span class="o">==</span> <span class="s1">&#39;S&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">y</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">labelsep</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">y</span>

<div class="viewcode-block" id="QuiverKey.draw"><a class="viewcode-back" href="../../api/_as_gen/matplotlib.quiver.QuiverKey.html#matplotlib.quiver.QuiverKey.draw">[docs]</a>    <span class="nd">@martist</span><span class="o">.</span><span class="n">allow_rasterization</span>
    <span class="k">def</span> <span class="nf">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">renderer</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vector</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">renderer</span><span class="p">)</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_transform</span><span class="p">()</span><span class="o">.</span><span class="n">transform</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Y</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">set_x</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_text_x</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">set_y</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_text_y</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">renderer</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stale</span> <span class="o">=</span> <span class="kc">False</span></div>

    <span class="k">def</span> <span class="nf">_set_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_transform</span><span class="p">(</span><span class="n">cbook</span><span class="o">.</span><span class="n">_check_getitem</span><span class="p">({</span>
            <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">transData</span><span class="p">,</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>
            <span class="s2">&quot;figure&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">transFigure</span><span class="p">,</span>
            <span class="s2">&quot;inches&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">dpi_scale_trans</span><span class="p">,</span>
        <span class="p">},</span> <span class="n">coordinates</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">coord</span><span class="p">))</span>

<div class="viewcode-block" id="QuiverKey.set_figure"><a class="viewcode-back" href="../../api/_as_gen/matplotlib.quiver.QuiverKey.html#matplotlib.quiver.QuiverKey.set_figure">[docs]</a>    <span class="k">def</span> <span class="nf">set_figure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fig</span><span class="p">):</span>
        <span class="n">martist</span><span class="o">.</span><span class="n">Artist</span><span class="o">.</span><span class="n">set_figure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fig</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">set_figure</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span></div>

<div class="viewcode-block" id="QuiverKey.contains"><a class="viewcode-back" href="../../api/_as_gen/matplotlib.quiver.QuiverKey.html#matplotlib.quiver.QuiverKey.contains">[docs]</a>    <span class="k">def</span> <span class="nf">contains</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mouseevent</span><span class="p">):</span>
        <span class="n">inside</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_contains</span><span class="p">(</span><span class="n">mouseevent</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">inside</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">inside</span><span class="p">,</span> <span class="n">info</span>
        <span class="c1"># Maybe the dictionary should allow one to</span>
        <span class="c1"># distinguish between a text hit and a vector hit.</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">mouseevent</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">vector</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">mouseevent</span><span class="p">)[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="p">{}</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="p">{}</span></div>

    <span class="nd">@cbook</span><span class="o">.</span><span class="n">deprecated</span><span class="p">(</span><span class="s2">&quot;3.2&quot;</span><span class="p">)</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">quiverkey_doc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__init__</span><span class="o">.</span><span class="vm">__doc__</span></div>


<span class="k">def</span> <span class="nf">_parse_args</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">caller_name</span><span class="o">=</span><span class="s1">&#39;function&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Helper function to parse positional parameters for colored vector plots.</span>

<span class="sd">    This is currently used for Quiver and Barbs.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    *args : list</span>
<span class="sd">        list of 2-5 arguments. Depending on their number they are parsed to::</span>

<span class="sd">            U, V</span>
<span class="sd">            U, V, C</span>
<span class="sd">            X, Y, U, V</span>
<span class="sd">            X, Y, U, V, C</span>

<span class="sd">    caller_name : str</span>
<span class="sd">        Name of the calling method (used in error messages).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">C</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">len_args</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">len_args</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="c1"># The use of atleast_1d allows for handling scalar arguments while also</span>
        <span class="c1"># keeping masked arrays</span>
        <span class="n">U</span><span class="p">,</span> <span class="n">V</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">len_args</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">U</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">C</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">len_args</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
        <span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">U</span><span class="p">,</span> <span class="n">V</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">len_args</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
        <span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">U</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">C</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">caller_name</span><span class="si">}</span><span class="s1"> takes 2-5 positional arguments but &#39;</span>
                        <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">len_args</span><span class="si">}</span><span class="s1"> were given&#39;</span><span class="p">)</span>

    <span class="n">nr</span><span class="p">,</span> <span class="n">nc</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">U</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">if</span> <span class="n">U</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">U</span><span class="o">.</span><span class="n">shape</span>

    <span class="k">if</span> <span class="n">X</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
        <span class="n">Y</span> <span class="o">=</span> <span class="n">Y</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="o">==</span> <span class="n">nc</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">Y</span><span class="p">)</span> <span class="o">==</span> <span class="n">nr</span><span class="p">:</span>
            <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">)]</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">Y</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;X and Y must be the same size, but &#39;</span>
                             <span class="sa">f</span><span class="s1">&#39;X.size is </span><span class="si">{</span><span class="n">X</span><span class="o">.</span><span class="n">size</span><span class="si">}</span><span class="s1"> and Y.size is </span><span class="si">{</span><span class="n">Y</span><span class="o">.</span><span class="n">size</span><span class="si">}</span><span class="s1">.&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">indexgrid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nc</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nr</span><span class="p">))</span>
        <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">indexgrid</span><span class="p">]</span>
    <span class="c1"># Size validation for U, V, C is left to the set_UVC method.</span>
    <span class="k">return</span> <span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">U</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">C</span>


<span class="k">def</span> <span class="nf">_check_consistent_shapes</span><span class="p">(</span><span class="o">*</span><span class="n">arrays</span><span class="p">):</span>
    <span class="n">all_shapes</span> <span class="o">=</span> <span class="p">{</span><span class="n">a</span><span class="o">.</span><span class="n">shape</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">arrays</span><span class="p">}</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_shapes</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;The shapes of the passed in arrays do not match&#39;</span><span class="p">)</span>


<div class="viewcode-block" id="Quiver"><a class="viewcode-back" href="../../api/_as_gen/matplotlib.quiver.Quiver.html#matplotlib.quiver.Quiver">[docs]</a><span class="k">class</span> <span class="nc">Quiver</span><span class="p">(</span><span class="n">mcollections</span><span class="o">.</span><span class="n">PolyCollection</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Specialized PolyCollection for arrows.</span>

<span class="sd">    The only API method is set_UVC(), which can be used</span>
<span class="sd">    to change the size, orientation, and color of the</span>
<span class="sd">    arrows; their locations are fixed when the class is</span>
<span class="sd">    instantiated.  Possibly this method will be useful</span>
<span class="sd">    in animations.</span>

<span class="sd">    Much of the work in this class is done in the draw()</span>
<span class="sd">    method so that as much information as possible is available</span>
<span class="sd">    about the plot.  In subsequent draw() calls, recalculation</span>
<span class="sd">    is limited to things that might have changed, so there</span>
<span class="sd">    should be no performance penalty from putting the calculations</span>
<span class="sd">    in the draw() method.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_PIVOT_VALS</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;tail&#39;</span><span class="p">,</span> <span class="s1">&#39;middle&#39;</span><span class="p">,</span> <span class="s1">&#39;tip&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="Quiver.__init__"><a class="viewcode-back" href="../../api/_as_gen/matplotlib.quiver.Quiver.html#matplotlib.quiver.Quiver.__init__">[docs]</a>    <span class="nd">@docstring</span><span class="o">.</span><span class="n">Substitution</span><span class="p">(</span><span class="n">_quiver_doc</span><span class="p">)</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span>
                 <span class="n">scale</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">headwidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">headlength</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">headaxislength</span><span class="o">=</span><span class="mf">4.5</span><span class="p">,</span>
                 <span class="n">minshaft</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">minlength</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;width&#39;</span><span class="p">,</span> <span class="n">scale_units</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">angles</span><span class="o">=</span><span class="s1">&#39;uv&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">pivot</span><span class="o">=</span><span class="s1">&#39;tail&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The constructor takes one required argument, an Axes</span>
<span class="sd">        instance, followed by the args and kwargs described</span>
<span class="sd">        by the following pyplot interface documentation:</span>
<span class="sd">        %s</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_axes</span> <span class="o">=</span> <span class="n">ax</span>  <span class="c1"># The attr actually set by the Artist.axes property.</span>
        <span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">U</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">C</span> <span class="o">=</span> <span class="n">_parse_args</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">caller_name</span><span class="o">=</span><span class="s1">&#39;quiver()&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="o">=</span> <span class="n">X</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Y</span> <span class="o">=</span> <span class="n">Y</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">XY</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scale</span> <span class="o">=</span> <span class="n">scale</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">headwidth</span> <span class="o">=</span> <span class="n">headwidth</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">headlength</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">headlength</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">headaxislength</span> <span class="o">=</span> <span class="n">headaxislength</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">minshaft</span> <span class="o">=</span> <span class="n">minshaft</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">minlength</span> <span class="o">=</span> <span class="n">minlength</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="n">units</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scale_units</span> <span class="o">=</span> <span class="n">scale_units</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">angles</span> <span class="o">=</span> <span class="n">angles</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">width</span>

        <span class="k">if</span> <span class="n">pivot</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;mid&#39;</span><span class="p">:</span>
            <span class="n">pivot</span> <span class="o">=</span> <span class="s1">&#39;middle&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pivot</span> <span class="o">=</span> <span class="n">pivot</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">cbook</span><span class="o">.</span><span class="n">_check_in_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_PIVOT_VALS</span><span class="p">,</span> <span class="n">pivot</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pivot</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">transform</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;transform&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">.</span><span class="n">transData</span><span class="p">)</span>
        <span class="n">kw</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;facecolors&#39;</span><span class="p">,</span> <span class="n">color</span><span class="p">)</span>
        <span class="n">kw</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;linewidths&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,))</span>
        <span class="n">mcollections</span><span class="o">.</span><span class="n">PolyCollection</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">[],</span> <span class="n">offsets</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">XY</span><span class="p">,</span>
                                             <span class="n">transOffset</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">transform</span><span class="p">,</span>
                                             <span class="n">closed</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                             <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">polykw</span> <span class="o">=</span> <span class="n">kw</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_UVC</span><span class="p">(</span><span class="n">U</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">C</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_initialized</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">weak_self</span> <span class="o">=</span> <span class="n">weakref</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>  <span class="c1"># Prevent closure over the real self.</span>

        <span class="k">def</span> <span class="nf">on_dpi_change</span><span class="p">(</span><span class="n">fig</span><span class="p">):</span>
            <span class="n">self_weakref</span> <span class="o">=</span> <span class="n">weak_self</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">self_weakref</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># vertices depend on width, span which in turn depend on dpi</span>
                <span class="n">self_weakref</span><span class="o">.</span><span class="n">_new_UV</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="c1"># simple brute force update works because _init is called at</span>
                <span class="c1"># the start of draw.</span>
                <span class="n">self_weakref</span><span class="o">.</span><span class="n">_initialized</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_cid</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;dpi_changed&#39;</span><span class="p">,</span> <span class="n">on_dpi_change</span><span class="p">)</span></div>

<div class="viewcode-block" id="Quiver.ax"><a class="viewcode-back" href="../../api/_as_gen/matplotlib.quiver.Quiver.html#matplotlib.quiver.Quiver.ax">[docs]</a>    <span class="nd">@cbook</span><span class="o">.</span><span class="n">deprecated</span><span class="p">(</span><span class="s2">&quot;3.3&quot;</span><span class="p">,</span> <span class="n">alternative</span><span class="o">=</span><span class="s2">&quot;axes&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">ax</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span></div>

<div class="viewcode-block" id="Quiver.remove"><a class="viewcode-back" href="../../api/_as_gen/matplotlib.quiver.Quiver.html#matplotlib.quiver.Quiver.remove">[docs]</a>    <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># docstring inherited</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">disconnect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cid</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cid</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>  <span class="c1"># pass the remove call up the stack</span></div>

    <span class="k">def</span> <span class="nf">_init</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialization delayed until first draw;</span>
<span class="sd">        allow time for axes setup.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># It seems that there are not enough event notifications</span>
        <span class="c1"># available to have this work on an as-needed basis at present.</span>
        <span class="k">if</span> <span class="kc">True</span><span class="p">:</span>  <span class="c1"># not self._initialized:</span>
            <span class="n">trans</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_transform</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">span</span> <span class="o">=</span> <span class="n">trans</span><span class="o">.</span><span class="n">inverted</span><span class="p">()</span><span class="o">.</span><span class="n">transform_bbox</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">bbox</span><span class="p">)</span><span class="o">.</span><span class="n">width</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">sn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">),</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="mf">0.06</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">span</span> <span class="o">/</span> <span class="n">sn</span>

            <span class="c1"># _make_verts sets self.scale if not already specified</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_initialized</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_make_verts</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">U</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">V</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">angles</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_initialized</span> <span class="o">=</span> <span class="kc">True</span>

<div class="viewcode-block" id="Quiver.get_datalim"><a class="viewcode-back" href="../../api/_as_gen/matplotlib.quiver.Quiver.html#matplotlib.quiver.Quiver.get_datalim">[docs]</a>    <span class="k">def</span> <span class="nf">get_datalim</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">transData</span><span class="p">):</span>
        <span class="n">trans</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_transform</span><span class="p">()</span>
        <span class="n">transOffset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_offset_transform</span><span class="p">()</span>
        <span class="n">full_transform</span> <span class="o">=</span> <span class="p">(</span><span class="n">trans</span> <span class="o">-</span> <span class="n">transData</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">transOffset</span> <span class="o">-</span> <span class="n">transData</span><span class="p">)</span>
        <span class="n">XY</span> <span class="o">=</span> <span class="n">full_transform</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">XY</span><span class="p">)</span>
        <span class="n">bbox</span> <span class="o">=</span> <span class="n">transforms</span><span class="o">.</span><span class="n">Bbox</span><span class="o">.</span><span class="n">null</span><span class="p">()</span>
        <span class="n">bbox</span><span class="o">.</span><span class="n">update_from_data_xy</span><span class="p">(</span><span class="n">XY</span><span class="p">,</span> <span class="n">ignore</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">bbox</span></div>

<div class="viewcode-block" id="Quiver.draw"><a class="viewcode-back" href="../../api/_as_gen/matplotlib.quiver.Quiver.html#matplotlib.quiver.Quiver.draw">[docs]</a>    <span class="nd">@martist</span><span class="o">.</span><span class="n">allow_rasterization</span>
    <span class="k">def</span> <span class="nf">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">renderer</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init</span><span class="p">()</span>
        <span class="n">verts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_verts</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">U</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">V</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">angles</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_verts</span><span class="p">(</span><span class="n">verts</span><span class="p">,</span> <span class="n">closed</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_new_UV</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">mcollections</span><span class="o">.</span><span class="n">PolyCollection</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">renderer</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stale</span> <span class="o">=</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="Quiver.set_UVC"><a class="viewcode-back" href="../../api/_as_gen/matplotlib.quiver.Quiver.html#matplotlib.quiver.Quiver.set_UVC">[docs]</a>    <span class="k">def</span> <span class="nf">set_UVC</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">U</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">C</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># We need to ensure we have a copy, not a reference</span>
        <span class="c1"># to an array that might change before draw().</span>
        <span class="n">U</span> <span class="o">=</span> <span class="n">ma</span><span class="o">.</span><span class="n">masked_invalid</span><span class="p">(</span><span class="n">U</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
        <span class="n">V</span> <span class="o">=</span> <span class="n">ma</span><span class="o">.</span><span class="n">masked_invalid</span><span class="p">(</span><span class="n">V</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">C</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">C</span> <span class="o">=</span> <span class="n">ma</span><span class="o">.</span><span class="n">masked_invalid</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">var</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">((</span><span class="s1">&#39;U&#39;</span><span class="p">,</span> <span class="s1">&#39;V&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">),</span> <span class="p">(</span><span class="n">U</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">C</span><span class="p">)):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">var</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">var</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="ow">or</span> <span class="n">var</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Argument </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1"> has a size </span><span class="si">{</span><span class="n">var</span><span class="o">.</span><span class="n">size</span><span class="si">}</span><span class="s1">&#39;</span>
                                 <span class="sa">f</span><span class="s1">&#39; which does not match </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="si">}</span><span class="s1">,&#39;</span>
                                 <span class="s1">&#39; the number of arrow positions&#39;</span><span class="p">)</span>

        <span class="n">mask</span> <span class="o">=</span> <span class="n">ma</span><span class="o">.</span><span class="n">mask_or</span><span class="p">(</span><span class="n">U</span><span class="o">.</span><span class="n">mask</span><span class="p">,</span> <span class="n">V</span><span class="o">.</span><span class="n">mask</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">C</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="n">ma</span><span class="o">.</span><span class="n">mask_or</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">C</span><span class="o">.</span><span class="n">mask</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">mask</span> <span class="ow">is</span> <span class="n">ma</span><span class="o">.</span><span class="n">nomask</span><span class="p">:</span>
                <span class="n">C</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">filled</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">C</span> <span class="o">=</span> <span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">U</span> <span class="o">=</span> <span class="n">U</span><span class="o">.</span><span class="n">filled</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">V</span> <span class="o">=</span> <span class="n">V</span><span class="o">.</span><span class="n">filled</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Umask</span> <span class="o">=</span> <span class="n">mask</span>
        <span class="k">if</span> <span class="n">C</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_array</span><span class="p">(</span><span class="n">C</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_new_UV</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stale</span> <span class="o">=</span> <span class="kc">True</span></div>

    <span class="k">def</span> <span class="nf">_dots_per_unit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">units</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a scale factor for converting from units to pixels</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">units</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;xy&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">units</span> <span class="o">==</span> <span class="s1">&#39;x&#39;</span><span class="p">:</span>
                <span class="n">dx0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">viewLim</span><span class="o">.</span><span class="n">width</span>
                <span class="n">dx1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">bbox</span><span class="o">.</span><span class="n">width</span>
            <span class="k">elif</span> <span class="n">units</span> <span class="o">==</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span>
                <span class="n">dx0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">viewLim</span><span class="o">.</span><span class="n">height</span>
                <span class="n">dx1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">bbox</span><span class="o">.</span><span class="n">height</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># &#39;xy&#39; is assumed</span>
                <span class="n">dxx0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">viewLim</span><span class="o">.</span><span class="n">width</span>
                <span class="n">dxx1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">bbox</span><span class="o">.</span><span class="n">width</span>
                <span class="n">dyy0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">viewLim</span><span class="o">.</span><span class="n">height</span>
                <span class="n">dyy1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">bbox</span><span class="o">.</span><span class="n">height</span>
                <span class="n">dx1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hypot</span><span class="p">(</span><span class="n">dxx1</span><span class="p">,</span> <span class="n">dyy1</span><span class="p">)</span>
                <span class="n">dx0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hypot</span><span class="p">(</span><span class="n">dxx0</span><span class="p">,</span> <span class="n">dyy0</span><span class="p">)</span>
            <span class="n">dx</span> <span class="o">=</span> <span class="n">dx1</span> <span class="o">/</span> <span class="n">dx0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">units</span> <span class="o">==</span> <span class="s1">&#39;width&#39;</span><span class="p">:</span>
                <span class="n">dx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">bbox</span><span class="o">.</span><span class="n">width</span>
            <span class="k">elif</span> <span class="n">units</span> <span class="o">==</span> <span class="s1">&#39;height&#39;</span><span class="p">:</span>
                <span class="n">dx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">bbox</span><span class="o">.</span><span class="n">height</span>
            <span class="k">elif</span> <span class="n">units</span> <span class="o">==</span> <span class="s1">&#39;dots&#39;</span><span class="p">:</span>
                <span class="n">dx</span> <span class="o">=</span> <span class="mf">1.0</span>
            <span class="k">elif</span> <span class="n">units</span> <span class="o">==</span> <span class="s1">&#39;inches&#39;</span><span class="p">:</span>
                <span class="n">dx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">dpi</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;unrecognized units&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">dx</span>

    <span class="k">def</span> <span class="nf">_set_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the PolyCollection transform to go</span>
<span class="sd">        from arrow width units to pixels.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dots_per_unit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_trans_scale</span> <span class="o">=</span> <span class="n">dx</span>  <span class="c1"># pixels per arrow width unit</span>
        <span class="n">trans</span> <span class="o">=</span> <span class="n">transforms</span><span class="o">.</span><span class="n">Affine2D</span><span class="p">()</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">dx</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_transform</span><span class="p">(</span><span class="n">trans</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">trans</span>

    <span class="k">def</span> <span class="nf">_angles_lengths</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">U</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">xy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">transData</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">XY</span><span class="p">)</span>
        <span class="n">uv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">U</span><span class="p">,</span> <span class="n">V</span><span class="p">))</span>
        <span class="n">xyp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">transData</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">XY</span> <span class="o">+</span> <span class="n">eps</span> <span class="o">*</span> <span class="n">uv</span><span class="p">)</span>
        <span class="n">dxy</span> <span class="o">=</span> <span class="n">xyp</span> <span class="o">-</span> <span class="n">xy</span>
        <span class="n">angles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">dxy</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">dxy</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">lengths</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hypot</span><span class="p">(</span><span class="o">*</span><span class="n">dxy</span><span class="o">.</span><span class="n">T</span><span class="p">)</span> <span class="o">/</span> <span class="n">eps</span>
        <span class="k">return</span> <span class="n">angles</span><span class="p">,</span> <span class="n">lengths</span>

    <span class="k">def</span> <span class="nf">_make_verts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">U</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">angles</span><span class="p">):</span>
        <span class="n">uv</span> <span class="o">=</span> <span class="p">(</span><span class="n">U</span> <span class="o">+</span> <span class="n">V</span> <span class="o">*</span> <span class="mi">1</span><span class="n">j</span><span class="p">)</span>
        <span class="n">str_angles</span> <span class="o">=</span> <span class="n">angles</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">angles</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
        <span class="k">if</span> <span class="n">str_angles</span> <span class="o">==</span> <span class="s1">&#39;xy&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale_units</span> <span class="o">==</span> <span class="s1">&#39;xy&#39;</span><span class="p">:</span>
            <span class="c1"># Here eps is 1 so that if we get U, V by diffing</span>
            <span class="c1"># the X, Y arrays, the vectors will connect the</span>
            <span class="c1"># points, regardless of the axis scaling (including log).</span>
            <span class="n">angles</span><span class="p">,</span> <span class="n">lengths</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_angles_lengths</span><span class="p">(</span><span class="n">U</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">str_angles</span> <span class="o">==</span> <span class="s1">&#39;xy&#39;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale_units</span> <span class="o">==</span> <span class="s1">&#39;xy&#39;</span><span class="p">:</span>
            <span class="c1"># Calculate eps based on the extents of the plot</span>
            <span class="c1"># so that we don&#39;t end up with roundoff error from</span>
            <span class="c1"># adding a small number to a large.</span>
            <span class="n">eps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">dataLim</span><span class="o">.</span><span class="n">extents</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">*</span> <span class="mf">0.001</span>
            <span class="n">angles</span><span class="p">,</span> <span class="n">lengths</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_angles_lengths</span><span class="p">(</span><span class="n">U</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="n">eps</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">str_angles</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale_units</span> <span class="o">==</span> <span class="s1">&#39;xy&#39;</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">lengths</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">uv</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">sn</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">))</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Umask</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">ma</span><span class="o">.</span><span class="n">nomask</span><span class="p">:</span>
                <span class="n">amean</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">Umask</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">amean</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
            <span class="c1"># crude auto-scaling</span>
            <span class="c1"># scale is typical arrow length as a multiple of the arrow width</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="mf">1.8</span> <span class="o">*</span> <span class="n">amean</span> <span class="o">*</span> <span class="n">sn</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">span</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale_units</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scale</span> <span class="o">=</span> <span class="n">scale</span>
            <span class="n">widthu_per_lenu</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale_units</span> <span class="o">==</span> <span class="s1">&#39;xy&#39;</span><span class="p">:</span>
                <span class="n">dx</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">dx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dots_per_unit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scale_units</span><span class="p">)</span>
            <span class="n">widthu_per_lenu</span> <span class="o">=</span> <span class="n">dx</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trans_scale</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scale</span> <span class="o">=</span> <span class="n">scale</span> <span class="o">*</span> <span class="n">widthu_per_lenu</span>
        <span class="n">length</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="p">(</span><span class="n">widthu_per_lenu</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scale</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">))</span>
        <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_h_arrows</span><span class="p">(</span><span class="n">length</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">str_angles</span> <span class="o">==</span> <span class="s1">&#39;xy&#39;</span><span class="p">:</span>
            <span class="n">theta</span> <span class="o">=</span> <span class="n">angles</span>
        <span class="k">elif</span> <span class="n">str_angles</span> <span class="o">==</span> <span class="s1">&#39;uv&#39;</span><span class="p">:</span>
            <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">uv</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">theta</span> <span class="o">=</span> <span class="n">ma</span><span class="o">.</span><span class="n">masked_invalid</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">angles</span><span class="p">))</span><span class="o">.</span><span class="n">filled</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">theta</span> <span class="o">=</span> <span class="n">theta</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>  <span class="c1"># for broadcasting</span>
        <span class="n">xy</span> <span class="o">=</span> <span class="p">(</span><span class="n">X</span> <span class="o">+</span> <span class="n">Y</span> <span class="o">*</span> <span class="mi">1</span><span class="n">j</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">theta</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span>
        <span class="n">XY</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">xy</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="n">xy</span><span class="o">.</span><span class="n">imag</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Umask</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">ma</span><span class="o">.</span><span class="n">nomask</span><span class="p">:</span>
            <span class="n">XY</span> <span class="o">=</span> <span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">XY</span><span class="p">)</span>
            <span class="n">XY</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">Umask</span><span class="p">]</span> <span class="o">=</span> <span class="n">ma</span><span class="o">.</span><span class="n">masked</span>
            <span class="c1"># This might be handled more efficiently with nans, given</span>
            <span class="c1"># that nans will end up in the paths anyway.</span>

        <span class="k">return</span> <span class="n">XY</span>

    <span class="k">def</span> <span class="nf">_h_arrows</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">length</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Length is in arrow width units.&quot;&quot;&quot;</span>
        <span class="c1"># It might be possible to streamline the code</span>
        <span class="c1"># and speed it up a bit by using complex (x, y)</span>
        <span class="c1"># instead of separate arrays; but any gain would be slight.</span>
        <span class="n">minsh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">minshaft</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">headlength</span>
        <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">length</span><span class="p">)</span>
        <span class="n">length</span> <span class="o">=</span> <span class="n">length</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="c1"># This number is chosen based on when pixel values overflow in Agg</span>
        <span class="c1"># causing rendering errors</span>
        <span class="c1"># length = np.minimum(length, 2 ** 16)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">length</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">**</span> <span class="mi">16</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="n">length</span><span class="p">)</span>
        <span class="c1"># x, y: normal horizontal arrow</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">headaxislength</span><span class="p">,</span>
                      <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">headlength</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                     <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">length</span>
        <span class="n">y</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">headwidth</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:],</span> <span class="n">N</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="c1"># x0, y0: arrow without shaft, for short vectors</span>
        <span class="n">x0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">minsh</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">headaxislength</span><span class="p">,</span>
                       <span class="n">minsh</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">headlength</span><span class="p">,</span> <span class="n">minsh</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="n">y0</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">headwidth</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="n">ii</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">x</span><span class="p">[:,</span> <span class="n">ii</span><span class="p">]</span>
        <span class="n">Y</span> <span class="o">=</span> <span class="n">y</span><span class="p">[:,</span> <span class="n">ii</span><span class="p">]</span>
        <span class="n">Y</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">X0</span> <span class="o">=</span> <span class="n">x0</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>
        <span class="n">Y0</span> <span class="o">=</span> <span class="n">y0</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>
        <span class="n">Y0</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">shrink</span> <span class="o">=</span> <span class="n">length</span> <span class="o">/</span> <span class="n">minsh</span> <span class="k">if</span> <span class="n">minsh</span> <span class="o">!=</span> <span class="mf">0.</span> <span class="k">else</span> <span class="mf">0.</span>
        <span class="n">X0</span> <span class="o">=</span> <span class="n">shrink</span> <span class="o">*</span> <span class="n">X0</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">Y0</span> <span class="o">=</span> <span class="n">shrink</span> <span class="o">*</span> <span class="n">Y0</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">short</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">length</span> <span class="o">&lt;</span> <span class="n">minsh</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="c1"># Now select X0, Y0 if short, otherwise X, Y</span>
        <span class="n">np</span><span class="o">.</span><span class="n">copyto</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">X0</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="n">short</span><span class="p">)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">copyto</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="n">Y0</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="n">short</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pivot</span> <span class="o">==</span> <span class="s1">&#39;middle&#39;</span><span class="p">:</span>
            <span class="n">X</span> <span class="o">-=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">X</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">pivot</span> <span class="o">==</span> <span class="s1">&#39;tip&#39;</span><span class="p">:</span>
            <span class="c1"># numpy bug? using -= does not work here unless we multiply by a</span>
            <span class="c1"># float first, as with &#39;mid&#39;.</span>
            <span class="n">X</span> <span class="o">=</span> <span class="n">X</span> <span class="o">-</span> <span class="n">X</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">pivot</span> <span class="o">!=</span> <span class="s1">&#39;tail&#39;</span><span class="p">:</span>
            <span class="n">cbook</span><span class="o">.</span><span class="n">_check_in_list</span><span class="p">([</span><span class="s2">&quot;middle&quot;</span><span class="p">,</span> <span class="s2">&quot;tip&quot;</span><span class="p">,</span> <span class="s2">&quot;tail&quot;</span><span class="p">],</span> <span class="n">pivot</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pivot</span><span class="p">)</span>

        <span class="n">tooshort</span> <span class="o">=</span> <span class="n">length</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">minlength</span>
        <span class="k">if</span> <span class="n">tooshort</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
            <span class="c1"># Use a heptagonal dot:</span>
            <span class="n">th</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">3.0</span><span class="p">)</span>
            <span class="n">x1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">th</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">minlength</span> <span class="o">*</span> <span class="mf">0.5</span>
            <span class="n">y1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">th</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">minlength</span> <span class="o">*</span> <span class="mf">0.5</span>
            <span class="n">X1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">x1</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:],</span> <span class="n">N</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">Y1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">y1</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:],</span> <span class="n">N</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">tooshort</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">tooshort</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">np</span><span class="o">.</span><span class="n">copyto</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">X1</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="n">tooshort</span><span class="p">)</span>
            <span class="n">np</span><span class="o">.</span><span class="n">copyto</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="n">Y1</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="n">tooshort</span><span class="p">)</span>
        <span class="c1"># Mask handling is deferred to the caller, _make_verts.</span>
        <span class="k">return</span> <span class="n">X</span><span class="p">,</span> <span class="n">Y</span>

    <span class="n">quiver_doc</span> <span class="o">=</span> <span class="n">_quiver_doc</span></div>


<span class="n">_barbs_doc</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">Plot a 2D field of barbs.</span>

<span class="s2">Call signature::</span>

<span class="s2">  barbs([X, Y], U, V, [C], **kw)</span>

<span class="s2">Where *X*, *Y* define the barb locations, *U*, *V* define the barb</span>
<span class="s2">directions, and *C* optionally sets the color.</span>

<span class="s2">All arguments may be 1D or 2D. *U*, *V*, *C* may be masked arrays, but masked</span>
<span class="s2">*X*, *Y* are not supported at present.</span>

<span class="s2">Barbs are traditionally used in meteorology as a way to plot the speed</span>
<span class="s2">and direction of wind observations, but can technically be used to</span>
<span class="s2">plot any two dimensional vector quantity.  As opposed to arrows, which</span>
<span class="s2">give vector magnitude by the length of the arrow, the barbs give more</span>
<span class="s2">quantitative information about the vector magnitude by putting slanted</span>
<span class="s2">lines or a triangle for various increments in magnitude, as show</span>
<span class="s2">schematically below::</span>

<span class="s2">  :                   /\    \</span>
<span class="s2">  :                  /  \    \</span>
<span class="s2">  :                 /    \    \    \</span>
<span class="s2">  :                /      \    \    \</span>
<span class="s2">  :               ------------------------------</span>

<span class="s2">The largest increment is given by a triangle (or &quot;flag&quot;). After those</span>
<span class="s2">come full lines (barbs). The smallest increment is a half line.  There</span>
<span class="s2">is only, of course, ever at most 1 half line.  If the magnitude is</span>
<span class="s2">small and only needs a single half-line and no full lines or</span>
<span class="s2">triangles, the half-line is offset from the end of the barb so that it</span>
<span class="s2">can be easily distinguished from barbs with a single full line.  The</span>
<span class="s2">magnitude for the barb shown above would nominally be 65, using the</span>
<span class="s2">standard increments of 50, 10, and 5.</span>

<span class="s2">See also https://en.wikipedia.org/wiki/Wind_barb.</span>

<span class="s2">Parameters</span>
<span class="s2">----------</span>
<span class="s2">X, Y : 1D or 2D array-like, optional</span>
<span class="s2">    The x and y coordinates of the barb locations. See *pivot* for how the</span>
<span class="s2">    barbs are drawn to the x, y positions.</span>

<span class="s2">    If not given, they will be generated as a uniform integer meshgrid based</span>
<span class="s2">    on the dimensions of *U* and *V*.</span>

<span class="s2">    If *X* and *Y* are 1D but *U*, *V* are 2D, *X*, *Y* are expanded to 2D</span>
<span class="s2">    using ``X, Y = np.meshgrid(X, Y)``. In this case ``len(X)`` and ``len(Y)``</span>
<span class="s2">    must match the column and row dimensions of *U* and *V*.</span>

<span class="s2">U, V : 1D or 2D array-like</span>
<span class="s2">    The x and y components of the barb shaft.</span>

<span class="s2">C : 1D or 2D array-like, optional</span>
<span class="s2">    Numeric data that defines the barb colors by colormapping via *norm* and</span>
<span class="s2">    *cmap*.</span>

<span class="s2">    This does not support explicit colors. If you want to set colors directly,</span>
<span class="s2">    use *barbcolor* instead.</span>

<span class="s2">length : float, default: 7</span>
<span class="s2">    Length of the barb in points; the other parts of the barb</span>
<span class="s2">    are scaled against this.</span>

<span class="s2">pivot : {&#39;tip&#39;, &#39;middle&#39;} or float, default: &#39;tip&#39;</span>
<span class="s2">    The part of the arrow that is anchored to the *X*, *Y* grid. The barb</span>
<span class="s2">    rotates about this point. This can also be a number, which shifts the</span>
<span class="s2">    start of the barb that many points away from grid point.</span>

<span class="s2">barbcolor : color or color sequence</span>
<span class="s2">    The color of all parts of the barb except for the flags.  This parameter</span>
<span class="s2">    is analogous to the *edgecolor* parameter for polygons, which can be used</span>
<span class="s2">    instead. However this parameter will override facecolor.</span>

<span class="s2">flagcolor : color or color sequence</span>
<span class="s2">    The color of any flags on the barb.  This parameter is analogous to the</span>
<span class="s2">    *facecolor* parameter for polygons, which can be used instead. However,</span>
<span class="s2">    this parameter will override facecolor.  If this is not set (and *C* has</span>
<span class="s2">    not either) then *flagcolor* will be set to match *barbcolor* so that the</span>
<span class="s2">    barb has a uniform color. If *C* has been set, *flagcolor* has no effect.</span>

<span class="s2">sizes : dict, optional</span>
<span class="s2">    A dictionary of coefficients specifying the ratio of a given</span>
<span class="s2">    feature to the length of the barb. Only those values one wishes to</span>
<span class="s2">    override need to be included.  These features include:</span>

<span class="s2">    - &#39;spacing&#39; - space between features (flags, full/half barbs)</span>
<span class="s2">    - &#39;height&#39; - height (distance from shaft to top) of a flag or full barb</span>
<span class="s2">    - &#39;width&#39; - width of a flag, twice the width of a full barb</span>
<span class="s2">    - &#39;emptybarb&#39; - radius of the circle used for low magnitudes</span>

<span class="s2">fill_empty : bool, default: False</span>
<span class="s2">    Whether the empty barbs (circles) that are drawn should be filled with</span>
<span class="s2">    the flag color.  If they are not filled, the center is transparent.</span>

<span class="s2">rounding : bool, default: True</span>
<span class="s2">    Whether the vector magnitude should be rounded when allocating barb</span>
<span class="s2">    components.  If True, the magnitude is rounded to the nearest multiple</span>
<span class="s2">    of the half-barb increment.  If False, the magnitude is simply truncated</span>
<span class="s2">    to the next lowest multiple.</span>

<span class="s2">barb_increments : dict, optional</span>
<span class="s2">    A dictionary of increments specifying values to associate with</span>
<span class="s2">    different parts of the barb. Only those values one wishes to</span>
<span class="s2">    override need to be included.</span>

<span class="s2">    - &#39;half&#39; - half barbs (Default is 5)</span>
<span class="s2">    - &#39;full&#39; - full barbs (Default is 10)</span>
<span class="s2">    - &#39;flag&#39; - flags (default is 50)</span>

<span class="s2">flip_barb : bool or array-like of bool, default: False</span>
<span class="s2">    Whether the lines and flags should point opposite to normal.</span>
<span class="s2">    Normal behavior is for the barbs and lines to point right (comes from wind</span>
<span class="s2">    barbs having these features point towards low pressure in the Northern</span>
<span class="s2">    Hemisphere).</span>

<span class="s2">    A single value is applied to all barbs. Individual barbs can be flipped by</span>
<span class="s2">    passing a bool array of the same size as *U* and *V*.</span>

<span class="s2">Returns</span>
<span class="s2">-------</span>
<span class="s2">barbs : `~matplotlib.quiver.Barbs`</span>

<span class="s2">Other Parameters</span>
<span class="s2">----------------</span>
<span class="s2">**kwargs</span>
<span class="s2">    The barbs can further be customized using `.PolyCollection` keyword</span>
<span class="s2">    arguments:</span>

<span class="s2">    </span><span class="si">%(PolyCollection)s</span><span class="s2"></span>
<span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="n">docstring</span><span class="o">.</span><span class="n">interpd</span><span class="o">.</span><span class="n">params</span>

<span class="n">docstring</span><span class="o">.</span><span class="n">interpd</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">barbs_doc</span><span class="o">=</span><span class="n">_barbs_doc</span><span class="p">)</span>


<div class="viewcode-block" id="Barbs"><a class="viewcode-back" href="../../api/_as_gen/matplotlib.quiver.Barbs.html#matplotlib.quiver.Barbs">[docs]</a><span class="k">class</span> <span class="nc">Barbs</span><span class="p">(</span><span class="n">mcollections</span><span class="o">.</span><span class="n">PolyCollection</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Specialized PolyCollection for barbs.</span>

<span class="sd">    The only API method is :meth:`set_UVC`, which can be used to</span>
<span class="sd">    change the size, orientation, and color of the arrows.  Locations</span>
<span class="sd">    are changed using the :meth:`set_offsets` collection method.</span>
<span class="sd">    Possibly this method will be useful in animations.</span>

<span class="sd">    There is one internal function :meth:`_find_tails` which finds</span>
<span class="sd">    exactly what should be put on the barb given the vector magnitude.</span>
<span class="sd">    From there :meth:`_make_barbs` is used to find the vertices of the</span>
<span class="sd">    polygon to represent the barb based on this information.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># This may be an abuse of polygons here to render what is essentially maybe</span>
    <span class="c1"># 1 triangle and a series of lines.  It works fine as far as I can tell</span>
    <span class="c1"># however.</span>
<div class="viewcode-block" id="Barbs.__init__"><a class="viewcode-back" href="../../api/_as_gen/matplotlib.quiver.Barbs.html#matplotlib.quiver.Barbs.__init__">[docs]</a>    <span class="nd">@docstring</span><span class="o">.</span><span class="n">interpd</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span>
                 <span class="n">pivot</span><span class="o">=</span><span class="s1">&#39;tip&#39;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">barbcolor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">flagcolor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">sizes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fill_empty</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">barb_increments</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">rounding</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">flip_barb</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The constructor takes one required argument, an Axes</span>
<span class="sd">        instance, followed by the args and kwargs described</span>
<span class="sd">        by the following pyplot interface documentation:</span>
<span class="sd">        %(barbs_doc)s</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sizes</span> <span class="o">=</span> <span class="n">sizes</span> <span class="ow">or</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fill_empty</span> <span class="o">=</span> <span class="n">fill_empty</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">barb_increments</span> <span class="o">=</span> <span class="n">barb_increments</span> <span class="ow">or</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rounding</span> <span class="o">=</span> <span class="n">rounding</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flip</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">flip_barb</span><span class="p">)</span>
        <span class="n">transform</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;transform&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">.</span><span class="n">transData</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pivot</span> <span class="o">=</span> <span class="n">pivot</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_length</span> <span class="o">=</span> <span class="n">length</span>
        <span class="n">barbcolor</span> <span class="o">=</span> <span class="n">barbcolor</span>
        <span class="n">flagcolor</span> <span class="o">=</span> <span class="n">flagcolor</span>

        <span class="c1"># Flagcolor and barbcolor provide convenience parameters for</span>
        <span class="c1"># setting the facecolor and edgecolor, respectively, of the barb</span>
        <span class="c1"># polygon.  We also work here to make the flag the same color as the</span>
        <span class="c1"># rest of the barb by default</span>

        <span class="k">if</span> <span class="kc">None</span> <span class="ow">in</span> <span class="p">(</span><span class="n">barbcolor</span><span class="p">,</span> <span class="n">flagcolor</span><span class="p">):</span>
            <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;edgecolors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;face&#39;</span>
            <span class="k">if</span> <span class="n">flagcolor</span><span class="p">:</span>
                <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;facecolors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">flagcolor</span>
            <span class="k">elif</span> <span class="n">barbcolor</span><span class="p">:</span>
                <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;facecolors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">barbcolor</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Set to facecolor passed in or default to black</span>
                <span class="n">kw</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;facecolors&#39;</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;edgecolors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">barbcolor</span>
            <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;facecolors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">flagcolor</span>

        <span class="c1"># Explicitly set a line width if we&#39;re not given one, otherwise</span>
        <span class="c1"># polygons are not outlined and we get no barbs</span>
        <span class="k">if</span> <span class="s1">&#39;linewidth&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kw</span> <span class="ow">and</span> <span class="s1">&#39;lw&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
            <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;linewidth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="c1"># Parse out the data arrays from the various configurations supported</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">_parse_args</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">caller_name</span><span class="o">=</span><span class="s1">&#39;barbs()&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">y</span>
        <span class="n">xy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>

        <span class="c1"># Make a collection</span>
        <span class="n">barb_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_length</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="mi">4</span>  <span class="c1"># Empirically determined</span>
        <span class="n">mcollections</span><span class="o">.</span><span class="n">PolyCollection</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">[],</span> <span class="p">(</span><span class="n">barb_size</span><span class="p">,),</span>
                                             <span class="n">offsets</span><span class="o">=</span><span class="n">xy</span><span class="p">,</span>
                                             <span class="n">transOffset</span><span class="o">=</span><span class="n">transform</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_transform</span><span class="p">(</span><span class="n">transforms</span><span class="o">.</span><span class="n">IdentityTransform</span><span class="p">())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set_UVC</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_find_tails</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mag</span><span class="p">,</span> <span class="n">rounding</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">half</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">full</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">flag</span><span class="o">=</span><span class="mi">50</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find how many of each of the tail pieces is necessary.  Flag</span>
<span class="sd">        specifies the increment for a flag, barb for a full barb, and half for</span>
<span class="sd">        half a barb. Mag should be the magnitude of a vector (i.e., &gt;= 0).</span>

<span class="sd">        This returns a tuple of:</span>

<span class="sd">            (*number of flags*, *number of barbs*, *half_flag*, *empty_flag*)</span>

<span class="sd">        The bool *half_flag* indicates whether half of a barb is needed,</span>
<span class="sd">        since there should only ever be one half on a given</span>
<span class="sd">        barb. *empty_flag* flag is an array of flags to easily tell if</span>
<span class="sd">        a barb is empty (too low to plot any barbs/flags.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># If rounding, round to the nearest multiple of half, the smallest</span>
        <span class="c1"># increment</span>
        <span class="k">if</span> <span class="n">rounding</span><span class="p">:</span>
            <span class="n">mag</span> <span class="o">=</span> <span class="n">half</span> <span class="o">*</span> <span class="p">(</span><span class="n">mag</span> <span class="o">/</span> <span class="n">half</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

        <span class="n">num_flags</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">mag</span> <span class="o">/</span> <span class="n">flag</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">mag</span> <span class="o">=</span> <span class="n">mag</span> <span class="o">%</span> <span class="n">flag</span>

        <span class="n">num_barb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">mag</span> <span class="o">/</span> <span class="n">full</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">mag</span> <span class="o">=</span> <span class="n">mag</span> <span class="o">%</span> <span class="n">full</span>

        <span class="n">half_flag</span> <span class="o">=</span> <span class="n">mag</span> <span class="o">&gt;=</span> <span class="n">half</span>
        <span class="n">empty_flag</span> <span class="o">=</span> <span class="o">~</span><span class="p">(</span><span class="n">half_flag</span> <span class="o">|</span> <span class="p">(</span><span class="n">num_flags</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">num_barb</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">num_flags</span><span class="p">,</span> <span class="n">num_barb</span><span class="p">,</span> <span class="n">half_flag</span><span class="p">,</span> <span class="n">empty_flag</span>

    <span class="k">def</span> <span class="nf">_make_barbs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">nflags</span><span class="p">,</span> <span class="n">nbarbs</span><span class="p">,</span> <span class="n">half_barb</span><span class="p">,</span> <span class="n">empty_flag</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span>
                    <span class="n">pivot</span><span class="p">,</span> <span class="n">sizes</span><span class="p">,</span> <span class="n">fill_empty</span><span class="p">,</span> <span class="n">flip</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create the wind barbs.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        u, v</span>
<span class="sd">            Components of the vector in the x and y directions, respectively.</span>

<span class="sd">        nflags, nbarbs, half_barb, empty_flag</span>
<span class="sd">            Respectively, the number of flags, number of barbs, flag for</span>
<span class="sd">            half a barb, and flag for empty barb, ostensibly obtained from</span>
<span class="sd">            :meth:`_find_tails`.</span>

<span class="sd">        length</span>
<span class="sd">            The length of the barb staff in points.</span>

<span class="sd">        pivot : {&quot;tip&quot;, &quot;middle&quot;} or number</span>
<span class="sd">            The point on the barb around which the entire barb should be</span>
<span class="sd">            rotated.  If a number, the start of the barb is shifted by that</span>
<span class="sd">            many points from the origin.</span>

<span class="sd">        sizes : dict</span>
<span class="sd">            Coefficients specifying the ratio of a given feature to the length</span>
<span class="sd">            of the barb. These features include:</span>

<span class="sd">            - *spacing*: space between features (flags, full/half barbs).</span>
<span class="sd">            - *height*: distance from shaft of top of a flag or full barb.</span>
<span class="sd">            - *width*: width of a flag, twice the width of a full barb.</span>
<span class="sd">            - *emptybarb*: radius of the circle used for low magnitudes.</span>

<span class="sd">        fill_empty : bool</span>
<span class="sd">            Whether the circle representing an empty barb should be filled or</span>
<span class="sd">            not (this changes the drawing of the polygon).</span>

<span class="sd">        flip : list of bool</span>
<span class="sd">            Whether the features should be flipped to the other side of the</span>
<span class="sd">            barb (useful for winds in the southern hemisphere).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list of arrays of vertices</span>
<span class="sd">            Polygon vertices for each of the wind barbs.  These polygons have</span>
<span class="sd">            been rotated to properly align with the vector direction.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># These control the spacing and size of barb elements relative to the</span>
        <span class="c1"># length of the shaft</span>
        <span class="n">spacing</span> <span class="o">=</span> <span class="n">length</span> <span class="o">*</span> <span class="n">sizes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;spacing&#39;</span><span class="p">,</span> <span class="mf">0.125</span><span class="p">)</span>
        <span class="n">full_height</span> <span class="o">=</span> <span class="n">length</span> <span class="o">*</span> <span class="n">sizes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;height&#39;</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">)</span>
        <span class="n">full_width</span> <span class="o">=</span> <span class="n">length</span> <span class="o">*</span> <span class="n">sizes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;width&#39;</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">)</span>
        <span class="n">empty_rad</span> <span class="o">=</span> <span class="n">length</span> <span class="o">*</span> <span class="n">sizes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;emptybarb&#39;</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">)</span>

        <span class="c1"># Controls y point where to pivot the barb.</span>
        <span class="n">pivot_points</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">tip</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">middle</span><span class="o">=-</span><span class="n">length</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">)</span>

        <span class="n">endx</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">endy</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">pivot</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="n">endy</span> <span class="o">=</span> <span class="n">pivot_points</span><span class="p">[</span><span class="n">pivot</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span>

        <span class="c1"># Get the appropriate angle for the vector components.  The offset is</span>
        <span class="c1"># due to the way the barb is initially drawn, going down the y-axis.</span>
        <span class="c1"># This makes sense in a meteorological mode of thinking since there 0</span>
        <span class="c1"># degrees corresponds to north (the y-axis traditionally)</span>
        <span class="n">angles</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">ma</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">u</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>

        <span class="c1"># Used for low magnitude.  We just get the vertices, so if we make it</span>
        <span class="c1"># out here, it can be reused.  The center set here should put the</span>
        <span class="c1"># center of the circle at the location(offset), rather than at the</span>
        <span class="c1"># same point as the barb pivot; this seems more sensible.</span>
        <span class="n">circ</span> <span class="o">=</span> <span class="n">CirclePolygon</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">radius</span><span class="o">=</span><span class="n">empty_rad</span><span class="p">)</span><span class="o">.</span><span class="n">get_verts</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">fill_empty</span><span class="p">:</span>
            <span class="n">empty_barb</span> <span class="o">=</span> <span class="n">circ</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># If we don&#39;t want the empty one filled, we make a degenerate</span>
            <span class="c1"># polygon that wraps back over itself</span>
            <span class="n">empty_barb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">circ</span><span class="p">,</span> <span class="n">circ</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>

        <span class="n">barb_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">angle</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">ndenumerate</span><span class="p">(</span><span class="n">angles</span><span class="p">):</span>
            <span class="c1"># If the vector magnitude is too weak to draw anything, plot an</span>
            <span class="c1"># empty circle instead</span>
            <span class="k">if</span> <span class="n">empty_flag</span><span class="p">[</span><span class="n">index</span><span class="p">]:</span>
                <span class="c1"># We can skip the transform since the circle has no preferred</span>
                <span class="c1"># orientation</span>
                <span class="n">barb_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">empty_barb</span><span class="p">)</span>
                <span class="k">continue</span>

            <span class="n">poly_verts</span> <span class="o">=</span> <span class="p">[(</span><span class="n">endx</span><span class="p">,</span> <span class="n">endy</span><span class="p">)]</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="n">length</span>

            <span class="c1"># Handle if this barb should be flipped</span>
            <span class="n">barb_height</span> <span class="o">=</span> <span class="o">-</span><span class="n">full_height</span> <span class="k">if</span> <span class="n">flip</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="k">else</span> <span class="n">full_height</span>

            <span class="c1"># Add vertices for each flag</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nflags</span><span class="p">[</span><span class="n">index</span><span class="p">]):</span>
                <span class="c1"># The spacing that works for the barbs is a little to much for</span>
                <span class="c1"># the flags, but this only occurs when we have more than 1</span>
                <span class="c1"># flag.</span>
                <span class="k">if</span> <span class="n">offset</span> <span class="o">!=</span> <span class="n">length</span><span class="p">:</span>
                    <span class="n">offset</span> <span class="o">+=</span> <span class="n">spacing</span> <span class="o">/</span> <span class="mf">2.</span>
                <span class="n">poly_verts</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                    <span class="p">[[</span><span class="n">endx</span><span class="p">,</span> <span class="n">endy</span> <span class="o">+</span> <span class="n">offset</span><span class="p">],</span>
                     <span class="p">[</span><span class="n">endx</span> <span class="o">+</span> <span class="n">barb_height</span><span class="p">,</span> <span class="n">endy</span> <span class="o">-</span> <span class="n">full_width</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">offset</span><span class="p">],</span>
                     <span class="p">[</span><span class="n">endx</span><span class="p">,</span> <span class="n">endy</span> <span class="o">-</span> <span class="n">full_width</span> <span class="o">+</span> <span class="n">offset</span><span class="p">]])</span>

                <span class="n">offset</span> <span class="o">-=</span> <span class="n">full_width</span> <span class="o">+</span> <span class="n">spacing</span>

            <span class="c1"># Add vertices for each barb.  These really are lines, but works</span>
            <span class="c1"># great adding 3 vertices that basically pull the polygon out and</span>
            <span class="c1"># back down the line</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nbarbs</span><span class="p">[</span><span class="n">index</span><span class="p">]):</span>
                <span class="n">poly_verts</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                    <span class="p">[(</span><span class="n">endx</span><span class="p">,</span> <span class="n">endy</span> <span class="o">+</span> <span class="n">offset</span><span class="p">),</span>
                     <span class="p">(</span><span class="n">endx</span> <span class="o">+</span> <span class="n">barb_height</span><span class="p">,</span> <span class="n">endy</span> <span class="o">+</span> <span class="n">offset</span> <span class="o">+</span> <span class="n">full_width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span>
                     <span class="p">(</span><span class="n">endx</span><span class="p">,</span> <span class="n">endy</span> <span class="o">+</span> <span class="n">offset</span><span class="p">)])</span>

                <span class="n">offset</span> <span class="o">-=</span> <span class="n">spacing</span>

            <span class="c1"># Add the vertices for half a barb, if needed</span>
            <span class="k">if</span> <span class="n">half_barb</span><span class="p">[</span><span class="n">index</span><span class="p">]:</span>
                <span class="c1"># If the half barb is the first on the staff, traditionally it</span>
                <span class="c1"># is offset from the end to make it easy to distinguish from a</span>
                <span class="c1"># barb with a full one</span>
                <span class="k">if</span> <span class="n">offset</span> <span class="o">==</span> <span class="n">length</span><span class="p">:</span>
                    <span class="n">poly_verts</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">endx</span><span class="p">,</span> <span class="n">endy</span> <span class="o">+</span> <span class="n">offset</span><span class="p">))</span>
                    <span class="n">offset</span> <span class="o">-=</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="n">spacing</span>
                <span class="n">poly_verts</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                    <span class="p">[(</span><span class="n">endx</span><span class="p">,</span> <span class="n">endy</span> <span class="o">+</span> <span class="n">offset</span><span class="p">),</span>
                     <span class="p">(</span><span class="n">endx</span> <span class="o">+</span> <span class="n">barb_height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">endy</span> <span class="o">+</span> <span class="n">offset</span> <span class="o">+</span> <span class="n">full_width</span> <span class="o">/</span> <span class="mi">4</span><span class="p">),</span>
                     <span class="p">(</span><span class="n">endx</span><span class="p">,</span> <span class="n">endy</span> <span class="o">+</span> <span class="n">offset</span><span class="p">)])</span>

            <span class="c1"># Rotate the barb according the angle. Making the barb first and</span>
            <span class="c1"># then rotating it made the math for drawing the barb really easy.</span>
            <span class="c1"># Also, the transform framework makes doing the rotation simple.</span>
            <span class="n">poly_verts</span> <span class="o">=</span> <span class="n">transforms</span><span class="o">.</span><span class="n">Affine2D</span><span class="p">()</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="o">-</span><span class="n">angle</span><span class="p">)</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span>
                <span class="n">poly_verts</span><span class="p">)</span>
            <span class="n">barb_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">poly_verts</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">barb_list</span>

<div class="viewcode-block" id="Barbs.set_UVC"><a class="viewcode-back" href="../../api/_as_gen/matplotlib.quiver.Barbs.html#matplotlib.quiver.Barbs.set_UVC">[docs]</a>    <span class="k">def</span> <span class="nf">set_UVC</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">U</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">C</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">u</span> <span class="o">=</span> <span class="n">ma</span><span class="o">.</span><span class="n">masked_invalid</span><span class="p">(</span><span class="n">U</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">v</span> <span class="o">=</span> <span class="n">ma</span><span class="o">.</span><span class="n">masked_invalid</span><span class="p">(</span><span class="n">V</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

        <span class="c1"># Flip needs to have the same number of entries as everything else.</span>
        <span class="c1"># Use broadcast_to to avoid a bloated array of identical values.</span>
        <span class="c1"># (can&#39;t rely on actual broadcasting)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flip</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">flip</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flip</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">u</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">flip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flip</span>

        <span class="k">if</span> <span class="n">C</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">ma</span><span class="o">.</span><span class="n">masked_invalid</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">flip</span> <span class="o">=</span> <span class="n">cbook</span><span class="o">.</span><span class="n">delete_masked_points</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">u</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span>
                <span class="n">flip</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span>
            <span class="n">_check_consistent_shapes</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">flip</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">flip</span> <span class="o">=</span> <span class="n">cbook</span><span class="o">.</span><span class="n">delete_masked_points</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">u</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">,</span> <span class="n">flip</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span>
            <span class="n">_check_consistent_shapes</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">flip</span><span class="p">)</span>

        <span class="n">magnitude</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hypot</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
        <span class="n">flags</span><span class="p">,</span> <span class="n">barbs</span><span class="p">,</span> <span class="n">halves</span><span class="p">,</span> <span class="n">empty</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_tails</span><span class="p">(</span><span class="n">magnitude</span><span class="p">,</span>
                                                       <span class="bp">self</span><span class="o">.</span><span class="n">rounding</span><span class="p">,</span>
                                                       <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">barb_increments</span><span class="p">)</span>

        <span class="c1"># Get the vertices for each of the barbs</span>

        <span class="n">plot_barbs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_barbs</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">flags</span><span class="p">,</span> <span class="n">barbs</span><span class="p">,</span> <span class="n">halves</span><span class="p">,</span> <span class="n">empty</span><span class="p">,</span>
                                      <span class="bp">self</span><span class="o">.</span><span class="n">_length</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pivot</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sizes</span><span class="p">,</span>
                                      <span class="bp">self</span><span class="o">.</span><span class="n">fill_empty</span><span class="p">,</span> <span class="n">flip</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_verts</span><span class="p">(</span><span class="n">plot_barbs</span><span class="p">)</span>

        <span class="c1"># Set the color array</span>
        <span class="k">if</span> <span class="n">C</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_array</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>

        <span class="c1"># Update the offsets in case the masked data changed</span>
        <span class="n">xy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_offsets</span> <span class="o">=</span> <span class="n">xy</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stale</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="Barbs.set_offsets"><a class="viewcode-back" href="../../api/_as_gen/matplotlib.quiver.Barbs.html#matplotlib.quiver.Barbs.set_offsets">[docs]</a>    <span class="k">def</span> <span class="nf">set_offsets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xy</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the offsets for the barb polygons.  This saves the offsets passed</span>
<span class="sd">        in and masks them as appropriate for the existing U/V data.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        xy : sequence of pairs of floats</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">xy</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">xy</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">cbook</span><span class="o">.</span><span class="n">delete_masked_points</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">u</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">)</span>
        <span class="n">_check_consistent_shapes</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
        <span class="n">xy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
        <span class="n">mcollections</span><span class="o">.</span><span class="n">PolyCollection</span><span class="o">.</span><span class="n">set_offsets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xy</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stale</span> <span class="o">=</span> <span class="kc">True</span></div>

    <span class="n">barbs_doc</span> <span class="o">=</span> <span class="n">_barbs_doc</span></div>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="clearer"></div>
    </div>
<footer>
    <div class="footer">
    &copy; Copyright 2002 - 2012 John Hunter, Darren Dale, Eric Firing, Michael Droettboom and the Matplotlib development team; 2012 - 2020 The Matplotlib development team.
<br />
    Last updated on Aug 24, 2020.
Created using
<a href="http://sphinx-doc.org/">Sphinx</a> 3.2.1.
Doc version v3.3.1-dirty.
    </div>
</footer>
<script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-55954603-1', 'auto');
        ga('send', 'pageview');

</script>
  </body>
</html>