
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MEP11: Third-party dependencies &#8212; Matplotlib 3.3.1 documentation</title>
    <link rel="stylesheet" href="../../_static/mpl.css?v3.3.1-dirty" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/gallery.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/gallery-binder.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/gallery-dataframe.css" />
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/language_data.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="search" type="application/opensearchdescription+xml"
          title="Search within Matplotlib 3.3.1 documentation"
          href="../../_static/opensearch.xml"/>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>

    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="MEP12: Improve Gallery and Examples" href="MEP12.html" />
    <link rel="prev" title="MEP10: Docstring consistency" href="MEP10.html" />
<link rel="top" title="Matplotlib 3.3.1 documentation" href="#" />
    <link rel="canonical" href="https://matplotlib.org/3.3.1/devel/MEP/MEP11.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>


<!--
<div id="annc-banner">

</div>
-->

<div style="background-color: white; text-align: left; padding: 10px 10px 15px 15px; position: relative;">
    <a href="../../index.html">
        <div style="float: left; position: absolute; width: 496px; bottom: 0; padding-bottom: 24px"><span style="float: right; color: #789; background: white">Version 3.3.1</span></div>
        <img src="../../_static/logo2_compressed.svg" height="125px" border="0" alt="matplotlib"/></a>

    <!-- The "Fork me on github" ribbon -->
    <div id="forkongithub"><a href="https://github.com/matplotlib/matplotlib">Fork me on GitHub</a></div>
    </div>

    <nav class="main-nav">
        <ul>
            <li><a href="../../users/installing.html">Installation</a></li>
            <li><a href="../../contents.html">Documentation</a></li>
            <li><a href="../../gallery/index.html">Examples</a></li>
            <li><a href="../../tutorials/index.html">Tutorials</a></li>
            <li><a href="../index.html">Contributing</a></li>
            <li class="nav-right">
                <form class="search" action="../../search.html" method="get">
                <input type="text" name="q" aria-labelledby="searchlabel" placeholder="Search"/>
                </form>
            </li>
        </ul>
     </nav>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="MEP12.html" title="MEP12: Improve Gallery and Examples"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="MEP10.html" title="MEP10: Docstring consistency"
             accesskey="P">previous</a> |</li>
        <li><a href="../../index.html">home</a>|&nbsp;</li>
        <li><a href="../../contents.html">contents</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >The Matplotlib Developers' Guide</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">Matplotlib Enhancement Proposals</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">MEP11: Third-party dependencies</a></li> 
      </ul>
    </div>

      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../contents.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">MEP11: Third-party dependencies</a><ul>
<li><a class="reference internal" href="#status">Status</a></li>
<li><a class="reference internal" href="#branches-and-pull-requests">Branches and Pull requests</a></li>
<li><a class="reference internal" href="#abstract">Abstract</a></li>
<li><a class="reference internal" href="#detailed-description">Detailed description</a><ul>
<li><a class="reference internal" href="#current-behavior">Current behavior</a></li>
<li><a class="reference internal" href="#desired-behavior">Desired behavior</a></li>
</ul>
</li>
<li><a class="reference internal" href="#implementation">Implementation</a></li>
<li><a class="reference internal" href="#backward-compatibility">Backward compatibility</a></li>
<li><a class="reference internal" href="#alternatives">Alternatives</a></li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../contents.html">Documentation overview</a><ul>
  <li><a href="../index.html">The Matplotlib Developers' Guide</a><ul>
  <li><a href="index.html">Matplotlib Enhancement Proposals</a><ul>
      <li>Previous: <a href="MEP10.html" title="previous chapter">MEP10: Docstring consistency</a></li>
      <li>Next: <a href="MEP12.html" title="next chapter">MEP12: Improve Gallery and Examples</a></li>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
</div>
  <div id="sidebar-pagesource" role="note" aria-label="source link"
    style="margin-top: 1.5em; padding-top: 0.1em; border-top: 1px solid #86989b">
  <a href="../../_sources/devel/MEP/MEP11.rst.txt"
     style="color: #c0c0c0" rel="nofollow">Show Page Source</a>
  </div>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="mep11-third-party-dependencies">
<h1>MEP11: Third-party dependencies<a class="headerlink" href="#mep11-third-party-dependencies" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#status" id="id1">Status</a></li>
<li><a class="reference internal" href="#branches-and-pull-requests" id="id2">Branches and Pull requests</a></li>
<li><a class="reference internal" href="#abstract" id="id3">Abstract</a></li>
<li><a class="reference internal" href="#detailed-description" id="id4">Detailed description</a><ul>
<li><a class="reference internal" href="#current-behavior" id="id5">Current behavior</a></li>
<li><a class="reference internal" href="#desired-behavior" id="id6">Desired behavior</a></li>
</ul>
</li>
<li><a class="reference internal" href="#implementation" id="id7">Implementation</a></li>
<li><a class="reference internal" href="#backward-compatibility" id="id8">Backward compatibility</a></li>
<li><a class="reference internal" href="#alternatives" id="id9">Alternatives</a></li>
</ul>
</div>
<p>This MEP attempts to improve the way in which third-party dependencies
in matplotlib are handled.</p>
<div class="section" id="status">
<h2><a class="toc-backref" href="#id1">Status</a><a class="headerlink" href="#status" title="Permalink to this headline">¶</a></h2>
<p><strong>Completed</strong> -- needs to be merged</p>
</div>
<div class="section" id="branches-and-pull-requests">
<h2><a class="toc-backref" href="#id2">Branches and Pull requests</a><a class="headerlink" href="#branches-and-pull-requests" title="Permalink to this headline">¶</a></h2>
<p>#1157: Use automatic dependency resolution</p>
<p>#1290: Debundle pyparsing</p>
<p>#1261: Update six to 1.2</p>
</div>
<div class="section" id="abstract">
<h2><a class="toc-backref" href="#id3">Abstract</a><a class="headerlink" href="#abstract" title="Permalink to this headline">¶</a></h2>
<p>One of the goals of matplotlib has been to keep it as easy to install
as possible.  To that end, some third-party dependencies are included
in the source tree and, under certain circumstances, installed
alongside matplotlib.  This MEP aims to resolve some problems with
that approach, bring some consistency, while continuing to make
installation convenient.</p>
<p>At the time that was initially done, <a class="reference external" href="https://pypi.org/project/setuptools/">setuptools</a>, <a class="reference external" href="https://setuptools.readthedocs.io/en/latest/easy_install.html">easy_install</a> and
<a class="reference external" href="https://pypi.org">PyPI</a> were not mature enough to be relied on.  However, at present,
we should be able to safely leverage the &quot;modern&quot; versions of those
tools, <a class="reference external" href="https://pypi.org/project/distribute/">distribute</a> and <a class="reference external" href="https://pypi.org/project/pip/">pip</a>.</p>
<p>While matplotlib has dependencies on both Python libraries and C/C++
libraries, this MEP addresses only the Python libraries so as to not
confuse the issue.  C libraries represent a larger and mostly
orthogonal set of problems.</p>
</div>
<div class="section" id="detailed-description">
<h2><a class="toc-backref" href="#id4">Detailed description</a><a class="headerlink" href="#detailed-description" title="Permalink to this headline">¶</a></h2>
<p>matplotlib depends on the following third-party Python libraries:</p>
<blockquote>
<div><ul class="simple">
<li>Numpy</li>
<li>dateutil (pure Python)</li>
<li>pytz (pure Python)</li>
<li>six -- required by dateutil (pure Python)</li>
<li>pyparsing (pure Python)</li>
<li>PIL (optional)</li>
<li>GUI frameworks: pygtk, gobject, tkinter, PySide, PyQt4, wx (all
optional, but one is required for an interactive GUI)</li>
</ul>
</div></blockquote>
<div class="section" id="current-behavior">
<h3><a class="toc-backref" href="#id5">Current behavior</a><a class="headerlink" href="#current-behavior" title="Permalink to this headline">¶</a></h3>
<p>When installing from source, a <strong class="program">git</strong> checkout or <a class="reference external" href="https://pypi.org/project/pip/">pip</a>:</p>
<blockquote>
<div><ul class="simple">
<li><code class="file docutils literal notranslate"><span class="pre">setup.py</span></code> attempts to <code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">numpy</span></code>.  If this fails, the
installation fails.</li>
<li>For each of <a class="reference external" href="https://pypi.org/project/python-dateutil/">dateutil</a>, <a class="reference external" href="https://pypi.org/project/pytz/">pytz</a> and <a class="reference external" href="https://pypi.org/project/six/">six</a>, <code class="file docutils literal notranslate"><span class="pre">setup.py</span></code> attempts to
import them (from the top-level namespace).  If that fails,
matplotlib installs its local copy of the library into the
top-level namespace.</li>
<li><a class="reference external" href="https://pypi.org/project/pyparsing/">pyparsing</a> is always installed inside of the matplotlib
namespace.</li>
</ul>
</div></blockquote>
<p>This behavior is most surprising when used with <a class="reference external" href="https://pypi.org/project/pip/">pip</a>, because no
<a class="reference external" href="https://pypi.org/project/pip/">pip</a> dependency resolution is performed, even though it is likely to
work for all of these packages.</p>
<p>The fact that <a class="reference external" href="https://pypi.org/project/pyparsing/">pyparsing</a> is installed in the matplotlib namespace has
reportedly (#1290) confused some users into thinking it is a
matplotlib-related module and import it from there rather than the
top-level.</p>
<p>When installing using the Windows installer, <a class="reference external" href="https://pypi.org/project/python-dateutil/">dateutil</a>, <a class="reference external" href="https://pypi.org/project/pytz/">pytz</a> and
<a class="reference external" href="https://pypi.org/project/six/">six</a> are installed at the top-level <em>always</em>, potentially overwriting
already installed copies of those libraries.</p>
<p>TODO: Describe behavior with the OS-X installer.</p>
<p>When installing using a package manager (Debian, RedHat, MacPorts
etc.), this behavior actually does the right thing, and there are no
special patches in the matplotlib packages to deal with the fact that
we handle <a class="reference external" href="https://pypi.org/project/python-dateutil/">dateutil</a>, <a class="reference external" href="https://pypi.org/project/pytz/">pytz</a> and <a class="reference external" href="https://pypi.org/project/six/">six</a> in this way.  However, care
should be taken that whatever approach we move to continues to work in
that context.</p>
<p>Maintaining these packages in the matplotlib tree and making sure they
are up-to-date is a maintenance burden.  Advanced new features that
may require a third-party pure Python library have a higher barrier to
inclusion because of this burden.</p>
</div>
<div class="section" id="desired-behavior">
<h3><a class="toc-backref" href="#id6">Desired behavior</a><a class="headerlink" href="#desired-behavior" title="Permalink to this headline">¶</a></h3>
<p>Third-party dependencies are downloaded and installed from their
canonical locations by leveraging <a class="reference external" href="https://pypi.org/project/pip/">pip</a>, <a class="reference external" href="https://pypi.org/project/distribute/">distribute</a> and <a class="reference external" href="https://pypi.org">PyPI</a>.</p>
<p><a class="reference external" href="https://pypi.org/project/python-dateutil/">dateutil</a>, <a class="reference external" href="https://pypi.org/project/pytz/">pytz</a>, and <a class="reference external" href="https://pypi.org/project/pyparsing/">pyparsing</a> should be made into optional
dependencies -- though obviously some features would fail if they
aren't installed.  This will allow the user to decide whether they
want to bother installing a particular feature.</p>
</div>
</div>
<div class="section" id="implementation">
<h2><a class="toc-backref" href="#id7">Implementation</a><a class="headerlink" href="#implementation" title="Permalink to this headline">¶</a></h2>
<p>For installing from source, and assuming the user has all of the
C-level compilers and dependencies, this can be accomplished fairly
easily using <a class="reference external" href="https://pypi.org/project/distribute/">distribute</a> and following the instructions <a class="reference external" href="https://pypi.org/project/distribute">here</a>.  The only anticipated
change to the matplotlib library code will be to import <a class="reference external" href="https://pypi.org/project/pyparsing/">pyparsing</a>
from the top-level namespace rather than from within matplotlib.  Note
that <a class="reference external" href="https://pypi.org/project/distribute/">distribute</a> will also allow us to remove the direct dependency
on <a class="reference external" href="https://pypi.org/project/six/">six</a>, since it is, strictly speaking, only a direct dependency of
<a class="reference external" href="https://pypi.org/project/python-dateutil/">dateutil</a>.</p>
<p>For binary installations, there are a number of alternatives (here
ordered from best/hardest to worst/easiest):</p>
<blockquote>
<div><ol class="arabic simple">
<li>The distutils wininst installer allows a post-install script to
run.  It might be possible to get this script to run <a class="reference external" href="https://pypi.org/project/pip/">pip</a> to
install the other dependencies.  (See <a class="reference external" href="http://grokbase.com/t/python/distutils-sig/109bdnfhp4/distutils-ann-setuptools-post-install-script-for-bdist-wininst">this thread</a>
for someone who has trod that ground before).</li>
<li>Continue to ship <a class="reference external" href="https://pypi.org/project/python-dateutil/">dateutil</a>, <a class="reference external" href="https://pypi.org/project/pytz/">pytz</a>, <a class="reference external" href="https://pypi.org/project/six/">six</a> and <a class="reference external" href="https://pypi.org/project/pyparsing/">pyparsing</a> in
our installer, but use the post-install-script to install them
<em>only</em> if they can not already be found.</li>
<li>Move all of these packages inside a (new) <code class="docutils literal notranslate"><span class="pre">matplotlib.extern</span></code>
namespace so it is clear for outside users that these are
external packages.  Add some conditional imports in the core
matplotlib codebase so <a class="reference external" href="https://pypi.org/project/python-dateutil/">dateutil</a> (at the top-level) is tried
first, and failing that <code class="docutils literal notranslate"><span class="pre">matplotlib.extern.dateutil</span></code> is used.</li>
</ol>
</div></blockquote>
<p>2 and 3 are undesirable as they still require maintaining copies of
these packages in our tree -- and this is exacerbated by the fact that
they are used less -- only in the binary installers.  None of these 3
approaches address Numpy, which will still have to be manually
installed using an installer.</p>
<p>TODO: How does this relate to the Mac OS-X installer?</p>
</div>
<div class="section" id="backward-compatibility">
<h2><a class="toc-backref" href="#id8">Backward compatibility</a><a class="headerlink" href="#backward-compatibility" title="Permalink to this headline">¶</a></h2>
<p>At present, matplotlib can be installed from source on a machine
without the third party dependencies and without an internet
connection.  After this change, an internet connection (and a working
PyPI) will be required to install matplotlib for the first time.
(Subsequent matplotlib updates or development work will run without
accessing the network).</p>
</div>
<div class="section" id="alternatives">
<h2><a class="toc-backref" href="#id9">Alternatives</a><a class="headerlink" href="#alternatives" title="Permalink to this headline">¶</a></h2>
<p>Distributing binary eggs doesn't feel like a usable solution.  That
requires getting <a class="reference external" href="https://setuptools.readthedocs.io/en/latest/easy_install.html">easy_install</a> installed first, and Windows users
generally prefer the well known <code class="docutils literal notranslate"><span class="pre">.exe</span></code> or <code class="docutils literal notranslate"><span class="pre">.msi</span></code> installer that works
out of the box.</p>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="clearer"></div>
    </div>
<footer>
    <div class="footer">
    &copy; Copyright 2002 - 2012 John Hunter, Darren Dale, Eric Firing, Michael Droettboom and the Matplotlib development team; 2012 - 2020 The Matplotlib development team.
<br />
    Last updated on Aug 24, 2020.
Created using
<a href="http://sphinx-doc.org/">Sphinx</a> 3.2.1.
Doc version v3.3.1-dirty.
    </div>
</footer>
<script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-55954603-1', 'auto');
        ga('send', 'pageview');

</script>
  </body>
</html>