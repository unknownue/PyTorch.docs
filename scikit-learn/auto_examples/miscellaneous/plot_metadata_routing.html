

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
<meta property="og:title" content="Metadata Routing" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://scikit-learn/stable/auto_examples/miscellaneous/plot_metadata_routing.html" />
<meta property="og:site_name" content="scikit-learn" />
<meta property="og:description" content="This document shows how you can use the metadata routing mechanism in scikit-learn to route metadata through meta-estimators to the estimators consuming them. To better understand the rest of the d..." />
<meta property="og:image" content="https://scikit-learn.org/stable/_static/scikit-learn-logo-small.png" />
<meta property="og:image:alt" content="scikit-learn" />
<meta name="description" content="This document shows how you can use the metadata routing mechanism in scikit-learn to route metadata through meta-estimators to the estimators consuming them. To better understand the rest of the d..." />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  
  <title>Metadata Routing &mdash; scikit-learn 1.3.2 documentation</title>
  
  <link rel="canonical" href="http://scikit-learn.org/stable/auto_examples/miscellaneous/plot_metadata_routing.html" />

  
  <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  

  <link rel="stylesheet" href="../../_static/css/vendor/bootstrap.min.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/copybutton.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/plot_directive.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/sg_gallery.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/sg_gallery-binder.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/sg_gallery-dataframe.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/sg_gallery-rendered-html.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
<script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
<script src="../../_static/js/vendor/jquery-3.6.3.slim.min.js"></script> 
</head>
<body>






<nav id="navbar" class="sk-docs-navbar navbar navbar-expand-md navbar-light bg-light py-0">
  <div class="container-fluid sk-docs-container px-0">
      <a class="navbar-brand py-0" href="../../index.html">
        <img
          class="sk-brand-img"
          src="../../_static/scikit-learn-logo-small.png"
          alt="logo"/>
      </a>
    <button
      id="sk-navbar-toggler"
      class="navbar-toggler"
      type="button"
      data-toggle="collapse"
      data-target="#navbarSupportedContent"
      aria-controls="navbarSupportedContent"
      aria-expanded="false"
      aria-label="Toggle navigation"
    >
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="sk-navbar-collapse collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav mr-auto">
        <li class="nav-item">
          <a class="sk-nav-link nav-link" href="../../install.html">Install</a>
        </li>
        <li class="nav-item">
          <a class="sk-nav-link nav-link" href="../../user_guide.html">User Guide</a>
        </li>
        <li class="nav-item">
          <a class="sk-nav-link nav-link" href="../../modules/classes.html">API</a>
        </li>
        <li class="nav-item">
          <a class="sk-nav-link nav-link" href="../index.html">Examples</a>
        </li>
        <li class="nav-item">
          <a class="sk-nav-link nav-link" target="_blank" rel="noopener noreferrer" href="https://blog.scikit-learn.org/">Community</a>
        </li>
        <li class="nav-item">
          <a class="sk-nav-link nav-link nav-more-item-mobile-items" href="../../getting_started.html" >Getting Started</a>
        </li>
        <li class="nav-item">
          <a class="sk-nav-link nav-link nav-more-item-mobile-items" href="../../tutorial/index.html" >Tutorial</a>
        </li>
        <li class="nav-item">
          <a class="sk-nav-link nav-link nav-more-item-mobile-items" href="../../whats_new/v1.3.html" >What's new</a>
        </li>
        <li class="nav-item">
          <a class="sk-nav-link nav-link nav-more-item-mobile-items" href="../../glossary.html" >Glossary</a>
        </li>
        <li class="nav-item">
          <a class="sk-nav-link nav-link nav-more-item-mobile-items" href="https://scikit-learn.org/dev/developers/index.html" target="_blank" rel="noopener noreferrer">Development</a>
        </li>
        <li class="nav-item">
          <a class="sk-nav-link nav-link nav-more-item-mobile-items" href="../../faq.html" >FAQ</a>
        </li>
        <li class="nav-item">
          <a class="sk-nav-link nav-link nav-more-item-mobile-items" href="../../support.html" >Support</a>
        </li>
        <li class="nav-item">
          <a class="sk-nav-link nav-link nav-more-item-mobile-items" href="../../related_projects.html" >Related packages</a>
        </li>
        <li class="nav-item">
          <a class="sk-nav-link nav-link nav-more-item-mobile-items" href="../../roadmap.html" >Roadmap</a>
        </li>
        <li class="nav-item">
          <a class="sk-nav-link nav-link nav-more-item-mobile-items" href="../../governance.html" >Governance</a>
        </li>
        <li class="nav-item">
          <a class="sk-nav-link nav-link nav-more-item-mobile-items" href="../../about.html" >About us</a>
        </li>
        <li class="nav-item">
          <a class="sk-nav-link nav-link nav-more-item-mobile-items" href="https://github.com/scikit-learn/scikit-learn" >GitHub</a>
        </li>
        <li class="nav-item">
          <a class="sk-nav-link nav-link nav-more-item-mobile-items" href="https://scikit-learn.org/dev/versions.html" >Other Versions and Download</a>
        </li>
        <li class="nav-item dropdown nav-more-item-dropdown">
          <a class="sk-nav-link nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">More</a>
          <div class="dropdown-menu" aria-labelledby="navbarDropdown">
              <a class="sk-nav-dropdown-item dropdown-item" href="../../getting_started.html" >Getting Started</a>
              <a class="sk-nav-dropdown-item dropdown-item" href="../../tutorial/index.html" >Tutorial</a>
              <a class="sk-nav-dropdown-item dropdown-item" href="../../whats_new/v1.3.html" >What's new</a>
              <a class="sk-nav-dropdown-item dropdown-item" href="../../glossary.html" >Glossary</a>
              <a class="sk-nav-dropdown-item dropdown-item" href="https://scikit-learn.org/dev/developers/index.html" target="_blank" rel="noopener noreferrer">Development</a>
              <a class="sk-nav-dropdown-item dropdown-item" href="../../faq.html" >FAQ</a>
              <a class="sk-nav-dropdown-item dropdown-item" href="../../support.html" >Support</a>
              <a class="sk-nav-dropdown-item dropdown-item" href="../../related_projects.html" >Related packages</a>
              <a class="sk-nav-dropdown-item dropdown-item" href="../../roadmap.html" >Roadmap</a>
              <a class="sk-nav-dropdown-item dropdown-item" href="../../governance.html" >Governance</a>
              <a class="sk-nav-dropdown-item dropdown-item" href="../../about.html" >About us</a>
              <a class="sk-nav-dropdown-item dropdown-item" href="https://github.com/scikit-learn/scikit-learn" >GitHub</a>
              <a class="sk-nav-dropdown-item dropdown-item" href="https://scikit-learn.org/dev/versions.html" >Other Versions and Download</a>
          </div>
        </li>
      </ul>
      <div id="searchbox" role="search">
          <div class="searchformwrapper">
          <form class="search" action="../../search.html" method="get">
            <input class="sk-search-text-input" type="text" name="q" aria-labelledby="searchlabel" />
            <input class="sk-search-text-btn" type="submit" value="Go" />
          </form>
          </div>
      </div>
    </div>
  </div>
</nav>
<div class="d-flex" id="sk-doc-wrapper">
    <input type="checkbox" name="sk-toggle-checkbox" id="sk-toggle-checkbox">
    <label id="sk-sidemenu-toggle" class="sk-btn-toggle-toc btn sk-btn-primary" for="sk-toggle-checkbox">Toggle Menu</label>
    <div id="sk-sidebar-wrapper" class="border-right">
      <div class="sk-sidebar-toc-wrapper">
        <div class="btn-group w-100 mb-2" role="group" aria-label="rellinks">
            <a href="plot_isotonic_regression.html" role="button" class="btn sk-btn-rellink py-1" sk-rellink-tooltip="Isotonic Regression">Prev</a><a href="index.html" role="button" class="btn sk-btn-rellink py-1" sk-rellink-tooltip="Miscellaneous">Up</a>
            <a href="plot_multilabel.html" role="button" class="btn sk-btn-rellink py-1" sk-rellink-tooltip="Multilabel classification">Next</a>
        </div>
        <div class="alert alert-danger p-1 mb-2" role="alert">
          <p class="text-center mb-0">
          <strong>scikit-learn 1.3.2</strong><br/>
          <a href="http://scikit-learn.org/dev/versions.html">Other versions</a>
          </p>
        </div>
        <div class="alert alert-warning p-1 mb-2" role="alert">
          <p class="text-center mb-0">
            Please <a class="font-weight-bold" href="../../about.html#citing-scikit-learn"><string>cite us</string></a> if you use the software.
          </p>
        </div>
            <div class="sk-sidebar-toc">
              <ul>
<li><a class="reference internal" href="#">Metadata Routing</a><ul>
<li><a class="reference internal" href="#estimators">Estimators</a></li>
<li><a class="reference internal" href="#router-and-consumer">Router and Consumer</a></li>
<li><a class="reference internal" href="#simple-pipeline">Simple Pipeline</a></li>
<li><a class="reference internal" href="#deprecation-default-value-change">Deprecation / Default Value Change</a></li>
<li><a class="reference internal" href="#third-party-development-and-scikit-learn-dependency">Third Party Development and scikit-learn Dependency</a></li>
</ul>
</li>
</ul>

            </div>
      </div>
    </div>
    <div id="sk-page-content-wrapper">
      <div class="sk-page-content container-fluid body px-md-3" role="main">
        
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="#sphx-glr-download-auto-examples-miscellaneous-plot-metadata-routing-py"><span class="std std-ref">Go to the end</span></a>
to download the full example code or to run this example in your browser via Binder</p>
</div>
<section class="sphx-glr-example-title" id="metadata-routing">
<span id="sphx-glr-auto-examples-miscellaneous-plot-metadata-routing-py"></span><h1>Metadata Routing<a class="headerlink" href="#metadata-routing" title="Link to this heading">¶</a></h1>
<p>This document shows how you can use the <a class="reference internal" href="../../metadata_routing.html#metadata-routing"><span class="std std-ref">metadata routing mechanism</span></a> in scikit-learn to route metadata through meta-estimators
to the estimators consuming them. To better understand the rest of the
document, we need to introduce two concepts: routers and consumers. A router is
an object, in most cases a meta-estimator, which forwards given data and
metadata to other objects and estimators. A consumer, on the other hand, is an
object which accepts and uses a certain given metadata. For instance, an
estimator taking into account <code class="docutils literal notranslate"><span class="pre">sample_weight</span></code> in its <a class="reference internal" href="../../glossary.html#term-fit"><span class="xref std std-term">fit</span></a> method is a
consumer of <code class="docutils literal notranslate"><span class="pre">sample_weight</span></code>. It is possible for an object to be both a router
and a consumer. For instance, a meta-estimator may take into account
<code class="docutils literal notranslate"><span class="pre">sample_weight</span></code> in certain calculations, but it may also route it to the
underlying estimator.</p>
<p>First a few imports and some random data for the rest of the script.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <a href="https://docs.python.org/3/library/pprint.html#pprint.pprint" title="pprint.pprint" class="sphx-glr-backref-module-pprint sphx-glr-backref-type-py-function"><span class="n">pprint</span></a>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <a href="../../modules/generated/sklearn.set_config.html#sklearn.set_config" title="sklearn.set_config" class="sphx-glr-backref-module-sklearn sphx-glr-backref-type-py-function"><span class="n">set_config</span></a>
<span class="kn">from</span> <span class="nn">sklearn.base</span> <span class="kn">import</span> <span class="p">(</span>
    <a href="../../modules/generated/sklearn.base.BaseEstimator.html#sklearn.base.BaseEstimator" title="sklearn.base.BaseEstimator" class="sphx-glr-backref-module-sklearn-base sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">BaseEstimator</span></a><span class="p">,</span>
    <a href="../../modules/generated/sklearn.base.ClassifierMixin.html#sklearn.base.ClassifierMixin" title="sklearn.base.ClassifierMixin" class="sphx-glr-backref-module-sklearn-base sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ClassifierMixin</span></a><span class="p">,</span>
    <a href="../../modules/generated/sklearn.base.MetaEstimatorMixin.html#sklearn.base.MetaEstimatorMixin" title="sklearn.base.MetaEstimatorMixin" class="sphx-glr-backref-module-sklearn-base sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">MetaEstimatorMixin</span></a><span class="p">,</span>
    <a href="../../modules/generated/sklearn.base.RegressorMixin.html#sklearn.base.RegressorMixin" title="sklearn.base.RegressorMixin" class="sphx-glr-backref-module-sklearn-base sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">RegressorMixin</span></a><span class="p">,</span>
    <a href="../../modules/generated/sklearn.base.TransformerMixin.html#sklearn.base.TransformerMixin" title="sklearn.base.TransformerMixin" class="sphx-glr-backref-module-sklearn-base sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">TransformerMixin</span></a><span class="p">,</span>
    <span class="n">clone</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <a href="../../modules/generated/sklearn.linear_model.LinearRegression.html#sklearn.linear_model.LinearRegression" title="sklearn.linear_model.LinearRegression" class="sphx-glr-backref-module-sklearn-linear_model sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">LinearRegression</span></a>
<span class="kn">from</span> <span class="nn">sklearn.utils</span> <span class="kn">import</span> <span class="n">metadata_routing</span>
<span class="kn">from</span> <span class="nn">sklearn.utils.metadata_routing</span> <span class="kn">import</span> <span class="p">(</span>
    <a href="../../modules/generated/sklearn.utils.metadata_routing.MetadataRouter.html#sklearn.utils.metadata_routing.MetadataRouter" title="sklearn.utils.metadata_routing.MetadataRouter" class="sphx-glr-backref-module-sklearn-utils-metadata_routing sphx-glr-backref-type-py-function"><span class="n">MetadataRouter</span></a><span class="p">,</span>
    <a href="../../modules/generated/sklearn.utils.metadata_routing.MethodMapping.html#sklearn.utils.metadata_routing.MethodMapping" title="sklearn.utils.metadata_routing.MethodMapping" class="sphx-glr-backref-module-sklearn-utils-metadata_routing sphx-glr-backref-type-py-function"><span class="n">MethodMapping</span></a><span class="p">,</span>
    <a href="../../modules/generated/sklearn.utils.metadata_routing.get_routing_for_object.html#sklearn.utils.metadata_routing.get_routing_for_object" title="sklearn.utils.metadata_routing.get_routing_for_object" class="sphx-glr-backref-module-sklearn-utils-metadata_routing sphx-glr-backref-type-py-function"><span class="n">get_routing_for_object</span></a><span class="p">,</span>
    <a href="../../modules/generated/sklearn.utils.metadata_routing.process_routing.html#sklearn.utils.metadata_routing.process_routing" title="sklearn.utils.metadata_routing.process_routing" class="sphx-glr-backref-module-sklearn-utils-metadata_routing sphx-glr-backref-type-py-function"><span class="n">process_routing</span></a><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">sklearn.utils.validation</span> <span class="kn">import</span> <a href="../../modules/generated/sklearn.utils.validation.check_is_fitted.html#sklearn.utils.validation.check_is_fitted" title="sklearn.utils.validation.check_is_fitted" class="sphx-glr-backref-module-sklearn-utils-validation sphx-glr-backref-type-py-function"><span class="n">check_is_fitted</span></a>

<span class="n">n_samples</span><span class="p">,</span> <span class="n">n_features</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">4</span>
<span class="n">rng</span> <span class="o">=</span> <a href="https://numpy.org/doc/stable/reference/random/legacy.html#numpy.random.RandomState" title="numpy.random.RandomState" class="sphx-glr-backref-module-numpy-random sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span></a><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">n_samples</span><span class="p">,</span> <span class="n">n_features</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">n_samples</span><span class="p">)</span>
<span class="n">my_groups</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">n_samples</span><span class="p">)</span>
<span class="n">my_weights</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">n_samples</span><span class="p">)</span>
<span class="n">my_other_weights</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">n_samples</span><span class="p">)</span>
</pre></div>
</div>
<p>This feature is only available if explicitly enabled:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><a href="../../modules/generated/sklearn.set_config.html#sklearn.set_config" title="sklearn.set_config" class="sphx-glr-backref-module-sklearn sphx-glr-backref-type-py-function"><span class="n">set_config</span></a><span class="p">(</span><span class="n">enable_metadata_routing</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>This utility function is a dummy to check if a metadata is passed.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">check_metadata</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Received </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> of length = </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="si">}</span><span class="s2"> in </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> is None in </span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>A utility function to nicely print the routing information of an object</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">print_routing</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
    <a href="https://docs.python.org/3/library/pprint.html#pprint.pprint" title="pprint.pprint" class="sphx-glr-backref-module-pprint sphx-glr-backref-type-py-function"><span class="n">pprint</span></a><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">get_metadata_routing</span><span class="p">()</span><span class="o">.</span><span class="n">_serialize</span><span class="p">())</span>
</pre></div>
</div>
<section id="estimators">
<h2>Estimators<a class="headerlink" href="#estimators" title="Link to this heading">¶</a></h2>
<p>Here we demonstrate how an estimator can expose the required API to support
metadata routing as a consumer. Imagine a simple classifier accepting
<code class="docutils literal notranslate"><span class="pre">sample_weight</span></code> as a metadata on its <code class="docutils literal notranslate"><span class="pre">fit</span></code> and <code class="docutils literal notranslate"><span class="pre">groups</span></code> in its
<code class="docutils literal notranslate"><span class="pre">predict</span></code> method:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ExampleClassifier</span><span class="p">(</span><a href="../../modules/generated/sklearn.base.ClassifierMixin.html#sklearn.base.ClassifierMixin" title="sklearn.base.ClassifierMixin" class="sphx-glr-backref-module-sklearn-base sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ClassifierMixin</span></a><span class="p">,</span> <a href="../../modules/generated/sklearn.base.BaseEstimator.html#sklearn.base.BaseEstimator" title="sklearn.base.BaseEstimator" class="sphx-glr-backref-module-sklearn-base sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">BaseEstimator</span></a><span class="p">):</span>
    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">sample_weight</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">check_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sample_weight</span><span class="o">=</span><span class="n">sample_weight</span><span class="p">)</span>
        <span class="c1"># all classifiers need to expose a classes_ attribute once they&#39;re fit.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">classes_</span> <span class="o">=</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.array.html#numpy.array" title="numpy.array" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">array</span></a><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">groups</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">check_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">groups</span><span class="o">=</span><span class="n">groups</span><span class="p">)</span>
        <span class="c1"># return a constant value of 1, not a very smart classifier!</span>
        <span class="k">return</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.ones.html#numpy.ones" title="numpy.ones" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">ones</span></a><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">))</span>
</pre></div>
</div>
<p>The above estimator now has all it needs to consume metadata. This is
accomplished by some magic done in <a class="reference internal" href="../../modules/generated/sklearn.base.BaseEstimator.html#sklearn.base.BaseEstimator" title="sklearn.base.BaseEstimator"><code class="xref py py-class docutils literal notranslate"><span class="pre">BaseEstimator</span></code></a>. There are
now three methods exposed by the above class: <code class="docutils literal notranslate"><span class="pre">set_fit_request</span></code>,
<code class="docutils literal notranslate"><span class="pre">set_predict_request</span></code>, and <code class="docutils literal notranslate"><span class="pre">get_metadata_routing</span></code>. There is also a
<code class="docutils literal notranslate"><span class="pre">set_score_request</span></code> for <code class="docutils literal notranslate"><span class="pre">sample_weight</span></code> which is present since
<a class="reference internal" href="../../modules/generated/sklearn.base.ClassifierMixin.html#sklearn.base.ClassifierMixin" title="sklearn.base.ClassifierMixin"><code class="xref py py-class docutils literal notranslate"><span class="pre">ClassifierMixin</span></code></a> implements a <code class="docutils literal notranslate"><span class="pre">score</span></code> method accepting
<code class="docutils literal notranslate"><span class="pre">sample_weight</span></code>. The same applies to regressors which inherit from
<a class="reference internal" href="../../modules/generated/sklearn.base.RegressorMixin.html#sklearn.base.RegressorMixin" title="sklearn.base.RegressorMixin"><code class="xref py py-class docutils literal notranslate"><span class="pre">RegressorMixin</span></code></a>.</p>
<p>By default, no metadata is requested, which we can see as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">print_routing</span><span class="p">(</span><span class="n">ExampleClassifier</span><span class="p">())</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>{&#39;fit&#39;: {&#39;sample_weight&#39;: None},
 &#39;predict&#39;: {&#39;groups&#39;: None},
 &#39;score&#39;: {&#39;sample_weight&#39;: None}}
</pre></div>
</div>
<p>The above output means that <code class="docutils literal notranslate"><span class="pre">sample_weight</span></code> and <code class="docutils literal notranslate"><span class="pre">groups</span></code> are not
requested, but if a router is given those metadata, it should raise an error,
since the user has not explicitly set whether they are required or not. The
same is true for <code class="docutils literal notranslate"><span class="pre">sample_weight</span></code> in the <code class="docutils literal notranslate"><span class="pre">score</span></code> method, which is
inherited from <a class="reference internal" href="../../modules/generated/sklearn.base.ClassifierMixin.html#sklearn.base.ClassifierMixin" title="sklearn.base.ClassifierMixin"><code class="xref py py-class docutils literal notranslate"><span class="pre">ClassifierMixin</span></code></a>. In order to explicitly set
request values for those metadata, we can use these methods:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">est</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">ExampleClassifier</span><span class="p">()</span>
    <span class="o">.</span><span class="n">set_fit_request</span><span class="p">(</span><span class="n">sample_weight</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="o">.</span><span class="n">set_predict_request</span><span class="p">(</span><span class="n">groups</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="o">.</span><span class="n">set_score_request</span><span class="p">(</span><span class="n">sample_weight</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">print_routing</span><span class="p">(</span><span class="n">est</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>{&#39;fit&#39;: {&#39;sample_weight&#39;: False},
 &#39;predict&#39;: {&#39;groups&#39;: True},
 &#39;score&#39;: {&#39;sample_weight&#39;: False}}
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Please note that as long as the above estimator is not used in another
meta-estimator, the user does not need to set any requests for the
metadata and the set values are ignored, since a consumer does not
validate or route given metadata. A simple usage of the above estimator
would work as expected.</p>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">est</span> <span class="o">=</span> <span class="n">ExampleClassifier</span><span class="p">()</span>
<span class="n">est</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">sample_weight</span><span class="o">=</span><span class="n">my_weights</span><span class="p">)</span>
<span class="n">est</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:],</span> <span class="n">groups</span><span class="o">=</span><span class="n">my_groups</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Received sample_weight of length = 100 in ExampleClassifier.
Received groups of length = 100 in ExampleClassifier.

array([1., 1., 1.])
</pre></div>
</div>
<p>Now let’s have a meta-estimator, which doesn’t do much other than routing the
metadata.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MetaClassifier</span><span class="p">(</span><a href="../../modules/generated/sklearn.base.MetaEstimatorMixin.html#sklearn.base.MetaEstimatorMixin" title="sklearn.base.MetaEstimatorMixin" class="sphx-glr-backref-module-sklearn-base sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">MetaEstimatorMixin</span></a><span class="p">,</span> <a href="../../modules/generated/sklearn.base.ClassifierMixin.html#sklearn.base.ClassifierMixin" title="sklearn.base.ClassifierMixin" class="sphx-glr-backref-module-sklearn-base sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ClassifierMixin</span></a><span class="p">,</span> <a href="../../modules/generated/sklearn.base.BaseEstimator.html#sklearn.base.BaseEstimator" title="sklearn.base.BaseEstimator" class="sphx-glr-backref-module-sklearn-base sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">BaseEstimator</span></a><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">estimator</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">estimator</span> <span class="o">=</span> <span class="n">estimator</span>

    <span class="k">def</span> <span class="nf">get_metadata_routing</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># This method defines the routing for this meta-estimator.</span>
        <span class="c1"># In order to do so, a `MetadataRouter` instance is created, and the</span>
        <span class="c1"># right routing is added to it. More explanations follow.</span>
        <span class="n">router</span> <span class="o">=</span> <a href="../../modules/generated/sklearn.utils.metadata_routing.MetadataRouter.html#sklearn.utils.metadata_routing.MetadataRouter" title="sklearn.utils.metadata_routing.MetadataRouter" class="sphx-glr-backref-module-sklearn-utils-metadata_routing sphx-glr-backref-type-py-function"><span class="n">MetadataRouter</span></a><span class="p">(</span><span class="n">owner</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
            <span class="n">estimator</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="p">,</span> <span class="n">method_mapping</span><span class="o">=</span><span class="s2">&quot;one-to-one&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">router</span>

    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="o">**</span><span class="n">fit_params</span><span class="p">):</span>
        <span class="c1"># meta-estimators are responsible for validating the given metadata.</span>
        <span class="c1"># `get_routing_for_object` is a safe way to construct a</span>
        <span class="c1"># `MetadataRouter` or a `MetadataRequest` from the given object.</span>
        <span class="n">request_router</span> <span class="o">=</span> <a href="../../modules/generated/sklearn.utils.metadata_routing.get_routing_for_object.html#sklearn.utils.metadata_routing.get_routing_for_object" title="sklearn.utils.metadata_routing.get_routing_for_object" class="sphx-glr-backref-module-sklearn-utils-metadata_routing sphx-glr-backref-type-py-function"><span class="n">get_routing_for_object</span></a><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">request_router</span><span class="o">.</span><span class="n">validate_metadata</span><span class="p">(</span><span class="n">params</span><span class="o">=</span><span class="n">fit_params</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;fit&quot;</span><span class="p">)</span>
        <span class="c1"># we can use provided utility methods to map the given metadata to what</span>
        <span class="c1"># is required by the underlying estimator. Here `method` refers to the</span>
        <span class="c1"># parent&#39;s method, i.e. `fit` in this example.</span>
        <span class="n">routed_params</span> <span class="o">=</span> <span class="n">request_router</span><span class="o">.</span><span class="n">route_params</span><span class="p">(</span><span class="n">params</span><span class="o">=</span><span class="n">fit_params</span><span class="p">,</span> <span class="n">caller</span><span class="o">=</span><span class="s2">&quot;fit&quot;</span><span class="p">)</span>

        <span class="c1"># the output has a key for each object&#39;s method which is used here,</span>
        <span class="c1"># i.e. parent&#39;s `fit` method, containing the metadata which should be</span>
        <span class="c1"># routed to them, based on the information provided in</span>
        <span class="c1"># `get_metadata_routing`.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">estimator_</span> <span class="o">=</span> <span class="n">clone</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="o">**</span><span class="n">routed_params</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">fit</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">classes_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">estimator_</span><span class="o">.</span><span class="n">classes_</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="o">**</span><span class="n">predict_params</span><span class="p">):</span>
        <a href="../../modules/generated/sklearn.utils.validation.check_is_fitted.html#sklearn.utils.validation.check_is_fitted" title="sklearn.utils.validation.check_is_fitted" class="sphx-glr-backref-module-sklearn-utils-validation sphx-glr-backref-type-py-function"><span class="n">check_is_fitted</span></a><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="c1"># same as in `fit`, we validate the given metadata</span>
        <span class="n">request_router</span> <span class="o">=</span> <a href="../../modules/generated/sklearn.utils.metadata_routing.get_routing_for_object.html#sklearn.utils.metadata_routing.get_routing_for_object" title="sklearn.utils.metadata_routing.get_routing_for_object" class="sphx-glr-backref-module-sklearn-utils-metadata_routing sphx-glr-backref-type-py-function"><span class="n">get_routing_for_object</span></a><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">request_router</span><span class="o">.</span><span class="n">validate_metadata</span><span class="p">(</span><span class="n">params</span><span class="o">=</span><span class="n">predict_params</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;predict&quot;</span><span class="p">)</span>
        <span class="c1"># and then prepare the input to the underlying `predict` method.</span>
        <span class="n">routed_params</span> <span class="o">=</span> <span class="n">request_router</span><span class="o">.</span><span class="n">route_params</span><span class="p">(</span>
            <span class="n">params</span><span class="o">=</span><span class="n">predict_params</span><span class="p">,</span> <span class="n">caller</span><span class="o">=</span><span class="s2">&quot;predict&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">estimator_</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="o">**</span><span class="n">routed_params</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">predict</span><span class="p">)</span>
</pre></div>
</div>
<p>Let’s break down different parts of the above code.</p>
<p>First, the <a class="reference internal" href="../../modules/generated/sklearn.utils.metadata_routing.get_routing_for_object.html#sklearn.utils.metadata_routing.get_routing_for_object" title="sklearn.utils.metadata_routing.get_routing_for_object"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_routing_for_object</span></code></a> takes an
estimator (<code class="docutils literal notranslate"><span class="pre">self</span></code>) and returns a
<a class="reference internal" href="../../modules/generated/sklearn.utils.metadata_routing.MetadataRouter.html#sklearn.utils.metadata_routing.MetadataRouter" title="sklearn.utils.metadata_routing.MetadataRouter"><code class="xref py py-class docutils literal notranslate"><span class="pre">MetadataRouter</span></code></a> or a
<a class="reference internal" href="../../modules/generated/sklearn.utils.metadata_routing.MetadataRequest.html#sklearn.utils.metadata_routing.MetadataRequest" title="sklearn.utils.metadata_routing.MetadataRequest"><code class="xref py py-class docutils literal notranslate"><span class="pre">MetadataRequest</span></code></a> based on the output of the
estimator’s <code class="docutils literal notranslate"><span class="pre">get_metadata_routing</span></code> method.</p>
<p>Then in each method, we use the <code class="docutils literal notranslate"><span class="pre">route_params</span></code> method to construct a
dictionary of the form <code class="docutils literal notranslate"><span class="pre">{&quot;object_name&quot;:</span> <span class="pre">{&quot;method_name&quot;:</span> <span class="pre">{&quot;metadata&quot;:</span>
<span class="pre">value}}}</span></code> to pass to the underlying estimator’s method. The <code class="docutils literal notranslate"><span class="pre">object_name</span></code>
(<code class="docutils literal notranslate"><span class="pre">estimator</span></code> in the above <code class="docutils literal notranslate"><span class="pre">routed_params.estimator.fit</span></code> example) is the
same as the one added in the <code class="docutils literal notranslate"><span class="pre">get_metadata_routing</span></code>. <code class="docutils literal notranslate"><span class="pre">validate_metadata</span></code>
makes sure all given metadata are requested to avoid silent bugs. Now, we
illustrate the different behaviors and notably the type of errors raised:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">est</span> <span class="o">=</span> <span class="n">MetaClassifier</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">ExampleClassifier</span><span class="p">()</span><span class="o">.</span><span class="n">set_fit_request</span><span class="p">(</span><span class="n">sample_weight</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<span class="n">est</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">sample_weight</span><span class="o">=</span><span class="n">my_weights</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Received sample_weight of length = 100 in ExampleClassifier.
</pre></div>
</div>
<div class="output_subarea output_html rendered_html output_result">
<style>#sk-container-id-48 {color: black;}#sk-container-id-48 pre{padding: 0;}#sk-container-id-48 div.sk-toggleable {background-color: white;}#sk-container-id-48 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-48 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-48 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-48 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-48 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-48 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-48 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-48 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-48 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-48 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-48 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-48 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-48 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-48 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-48 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-48 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-48 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-48 div.sk-item {position: relative;z-index: 1;}#sk-container-id-48 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-48 div.sk-item::before, #sk-container-id-48 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-48 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-48 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-48 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-48 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-48 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-48 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-48 div.sk-label-container {text-align: center;}#sk-container-id-48 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-48 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-48" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>MetaClassifier(estimator=ExampleClassifier())</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-216" type="checkbox" ><label for="sk-estimator-id-216" class="sk-toggleable__label sk-toggleable__label-arrow">MetaClassifier</label><div class="sk-toggleable__content"><pre>MetaClassifier(estimator=ExampleClassifier())</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-217" type="checkbox" ><label for="sk-estimator-id-217" class="sk-toggleable__label sk-toggleable__label-arrow">estimator: ExampleClassifier</label><div class="sk-toggleable__content"><pre>ExampleClassifier()</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-218" type="checkbox" ><label for="sk-estimator-id-218" class="sk-toggleable__label sk-toggleable__label-arrow">ExampleClassifier</label><div class="sk-toggleable__content"><pre>ExampleClassifier()</pre></div></div></div></div></div></div></div></div></div></div>
</div>
<br />
<br /><p>Note that the above example checks that <code class="docutils literal notranslate"><span class="pre">sample_weight</span></code> is correctly passed
to <code class="docutils literal notranslate"><span class="pre">ExampleClassifier</span></code>, or else it would print that <code class="docutils literal notranslate"><span class="pre">sample_weight</span></code> is
<code class="docutils literal notranslate"><span class="pre">None</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">est</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>sample_weight is None in ExampleClassifier.
</pre></div>
</div>
<div class="output_subarea output_html rendered_html output_result">
<style>#sk-container-id-49 {color: black;}#sk-container-id-49 pre{padding: 0;}#sk-container-id-49 div.sk-toggleable {background-color: white;}#sk-container-id-49 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-49 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-49 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-49 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-49 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-49 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-49 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-49 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-49 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-49 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-49 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-49 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-49 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-49 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-49 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-49 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-49 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-49 div.sk-item {position: relative;z-index: 1;}#sk-container-id-49 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-49 div.sk-item::before, #sk-container-id-49 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-49 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-49 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-49 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-49 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-49 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-49 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-49 div.sk-label-container {text-align: center;}#sk-container-id-49 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-49 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-49" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>MetaClassifier(estimator=ExampleClassifier())</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-219" type="checkbox" ><label for="sk-estimator-id-219" class="sk-toggleable__label sk-toggleable__label-arrow">MetaClassifier</label><div class="sk-toggleable__content"><pre>MetaClassifier(estimator=ExampleClassifier())</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-220" type="checkbox" ><label for="sk-estimator-id-220" class="sk-toggleable__label sk-toggleable__label-arrow">estimator: ExampleClassifier</label><div class="sk-toggleable__content"><pre>ExampleClassifier()</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-221" type="checkbox" ><label for="sk-estimator-id-221" class="sk-toggleable__label sk-toggleable__label-arrow">ExampleClassifier</label><div class="sk-toggleable__content"><pre>ExampleClassifier()</pre></div></div></div></div></div></div></div></div></div></div>
</div>
<br />
<br /><p>If we pass an unknown metadata, an error is raised:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="n">est</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test</span><span class="o">=</span><span class="n">my_weights</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">TypeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>fit got unexpected argument(s) {&#39;test&#39;}, which are not requested metadata in any object.
</pre></div>
</div>
<p>And if we pass a metadata which is not explicitly requested:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="n">est</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">sample_weight</span><span class="o">=</span><span class="n">my_weights</span><span class="p">)</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">groups</span><span class="o">=</span><span class="n">my_groups</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Received sample_weight of length = 100 in ExampleClassifier.
[groups] are passed but are not explicitly set as requested or not for ExampleClassifier.predict
</pre></div>
</div>
<p>Also, if we explicitly set it as not requested, but it is provided:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">est</span> <span class="o">=</span> <span class="n">MetaClassifier</span><span class="p">(</span>
    <span class="n">estimator</span><span class="o">=</span><span class="n">ExampleClassifier</span><span class="p">()</span>
    <span class="o">.</span><span class="n">set_fit_request</span><span class="p">(</span><span class="n">sample_weight</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="o">.</span><span class="n">set_predict_request</span><span class="p">(</span><span class="n">groups</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="p">)</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">est</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">sample_weight</span><span class="o">=</span><span class="n">my_weights</span><span class="p">)</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:],</span> <span class="n">groups</span><span class="o">=</span><span class="n">my_groups</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">TypeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Received sample_weight of length = 100 in ExampleClassifier.
predict got unexpected argument(s) {&#39;groups&#39;}, which are not requested metadata in any object.
</pre></div>
</div>
<p>Another concept to introduce is <strong>aliased metadata</strong>. This is when an estimator
requests a metadata with a different name than the default value. For
instance, in a setting where there are two estimators in a pipeline, one
could request <code class="docutils literal notranslate"><span class="pre">sample_weight1</span></code> and the other <code class="docutils literal notranslate"><span class="pre">sample_weight2</span></code>. Note that
this doesn’t change what the estimator expects, it only tells the
meta-estimator how to map the provided metadata to what’s required. Here’s an
example, where we pass <code class="docutils literal notranslate"><span class="pre">aliased_sample_weight</span></code> to the meta-estimator, but
the meta-estimator understands that <code class="docutils literal notranslate"><span class="pre">aliased_sample_weight</span></code> is an alias for
<code class="docutils literal notranslate"><span class="pre">sample_weight</span></code>, and passes it as <code class="docutils literal notranslate"><span class="pre">sample_weight</span></code> to the underlying
estimator:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">est</span> <span class="o">=</span> <span class="n">MetaClassifier</span><span class="p">(</span>
    <span class="n">estimator</span><span class="o">=</span><span class="n">ExampleClassifier</span><span class="p">()</span><span class="o">.</span><span class="n">set_fit_request</span><span class="p">(</span><span class="n">sample_weight</span><span class="o">=</span><span class="s2">&quot;aliased_sample_weight&quot;</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">est</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">aliased_sample_weight</span><span class="o">=</span><span class="n">my_weights</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Received sample_weight of length = 100 in ExampleClassifier.
</pre></div>
</div>
<div class="output_subarea output_html rendered_html output_result">
<style>#sk-container-id-50 {color: black;}#sk-container-id-50 pre{padding: 0;}#sk-container-id-50 div.sk-toggleable {background-color: white;}#sk-container-id-50 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-50 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-50 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-50 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-50 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-50 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-50 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-50 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-50 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-50 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-50 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-50 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-50 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-50 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-50 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-50 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-50 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-50 div.sk-item {position: relative;z-index: 1;}#sk-container-id-50 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-50 div.sk-item::before, #sk-container-id-50 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-50 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-50 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-50 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-50 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-50 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-50 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-50 div.sk-label-container {text-align: center;}#sk-container-id-50 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-50 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-50" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>MetaClassifier(estimator=ExampleClassifier())</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-222" type="checkbox" ><label for="sk-estimator-id-222" class="sk-toggleable__label sk-toggleable__label-arrow">MetaClassifier</label><div class="sk-toggleable__content"><pre>MetaClassifier(estimator=ExampleClassifier())</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-223" type="checkbox" ><label for="sk-estimator-id-223" class="sk-toggleable__label sk-toggleable__label-arrow">estimator: ExampleClassifier</label><div class="sk-toggleable__content"><pre>ExampleClassifier()</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-224" type="checkbox" ><label for="sk-estimator-id-224" class="sk-toggleable__label sk-toggleable__label-arrow">ExampleClassifier</label><div class="sk-toggleable__content"><pre>ExampleClassifier()</pre></div></div></div></div></div></div></div></div></div></div>
</div>
<br />
<br /><p>And passing <code class="docutils literal notranslate"><span class="pre">sample_weight</span></code> here will fail since it is requested with an
alias and <code class="docutils literal notranslate"><span class="pre">sample_weight</span></code> with that name is not requested:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="n">est</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">sample_weight</span><span class="o">=</span><span class="n">my_weights</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">TypeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>fit got unexpected argument(s) {&#39;sample_weight&#39;}, which are not requested metadata in any object.
</pre></div>
</div>
<p>This leads us to the <code class="docutils literal notranslate"><span class="pre">get_metadata_routing</span></code>. The way routing works in
scikit-learn is that consumers request what they need, and routers pass that
along. Additionally, a router exposes what it requires itself so that it can
be used inside another router, e.g. a pipeline inside a grid search object.
The output of the <code class="docutils literal notranslate"><span class="pre">get_metadata_routing</span></code> which is a dictionary
representation of a <a class="reference internal" href="../../modules/generated/sklearn.utils.metadata_routing.MetadataRouter.html#sklearn.utils.metadata_routing.MetadataRouter" title="sklearn.utils.metadata_routing.MetadataRouter"><code class="xref py py-class docutils literal notranslate"><span class="pre">MetadataRouter</span></code></a>, includes
the complete tree of requested metadata by all nested objects and their
corresponding method routings, i.e. which method of a sub-estimator is used
in which method of a meta-estimator:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">print_routing</span><span class="p">(</span><span class="n">est</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>{&#39;estimator&#39;: {&#39;mapping&#39;: [{&#39;callee&#39;: &#39;fit&#39;, &#39;caller&#39;: &#39;fit&#39;},
                           {&#39;callee&#39;: &#39;partial_fit&#39;, &#39;caller&#39;: &#39;partial_fit&#39;},
                           {&#39;callee&#39;: &#39;predict&#39;, &#39;caller&#39;: &#39;predict&#39;},
                           {&#39;callee&#39;: &#39;predict_proba&#39;,
                            &#39;caller&#39;: &#39;predict_proba&#39;},
                           {&#39;callee&#39;: &#39;predict_log_proba&#39;,
                            &#39;caller&#39;: &#39;predict_log_proba&#39;},
                           {&#39;callee&#39;: &#39;decision_function&#39;,
                            &#39;caller&#39;: &#39;decision_function&#39;},
                           {&#39;callee&#39;: &#39;score&#39;, &#39;caller&#39;: &#39;score&#39;},
                           {&#39;callee&#39;: &#39;split&#39;, &#39;caller&#39;: &#39;split&#39;},
                           {&#39;callee&#39;: &#39;transform&#39;, &#39;caller&#39;: &#39;transform&#39;},
                           {&#39;callee&#39;: &#39;inverse_transform&#39;,
                            &#39;caller&#39;: &#39;inverse_transform&#39;}],
               &#39;router&#39;: {&#39;fit&#39;: {&#39;sample_weight&#39;: &#39;aliased_sample_weight&#39;},
                          &#39;predict&#39;: {&#39;groups&#39;: None},
                          &#39;score&#39;: {&#39;sample_weight&#39;: None}}}}
</pre></div>
</div>
<p>As you can see, the only metadata requested for method <code class="docutils literal notranslate"><span class="pre">fit</span></code> is
<code class="docutils literal notranslate"><span class="pre">&quot;sample_weight&quot;</span></code> with <code class="docutils literal notranslate"><span class="pre">&quot;aliased_sample_weight&quot;</span></code> as the alias. The
<code class="docutils literal notranslate"><span class="pre">~utils.metadata_routing.MetadataRouter</span></code> class enables us to easily create
the routing object which would create the output we need for our
<code class="docutils literal notranslate"><span class="pre">get_metadata_routing</span></code>. In the above implementation,
<code class="docutils literal notranslate"><span class="pre">mapping=&quot;one-to-one&quot;</span></code> means there is a one to one mapping between
sub-estimator’s methods and meta-estimator’s ones, i.e. <code class="docutils literal notranslate"><span class="pre">fit</span></code> used in
<code class="docutils literal notranslate"><span class="pre">fit</span></code> and so on. In order to understand how aliases work in
meta-estimators, imagine our meta-estimator inside another one:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">meta_est</span> <span class="o">=</span> <span class="n">MetaClassifier</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">est</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">aliased_sample_weight</span><span class="o">=</span><span class="n">my_weights</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Received sample_weight of length = 100 in ExampleClassifier.
</pre></div>
</div>
<p>In the above example, this is how each <code class="docutils literal notranslate"><span class="pre">fit</span></code> method will call the
sub-estimator’s <code class="docutils literal notranslate"><span class="pre">fit</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="n">meta_est</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">aliased_sample_weight</span><span class="o">=</span><span class="n">my_weights</span><span class="p">):</span>
     <span class="o">...</span>  <span class="c1"># this estimator (est), expects aliased_sample_weight as seen above</span>
     <span class="bp">self</span><span class="o">.</span><span class="n">estimator_</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">aliased_sample_weight</span><span class="o">=</span><span class="n">aliased_sample_weight</span><span class="p">):</span>
         <span class="o">...</span>  <span class="c1"># now est passes aliased_sample_weight&#39;s value as sample_weight,</span>
              <span class="c1"># which is expected by the sub-estimator</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">estimator_</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">sample_weight</span><span class="o">=</span><span class="n">aliased_sample_weight</span><span class="p">)</span>
<span class="o">...</span>
</pre></div>
</div>
</section>
<section id="router-and-consumer">
<h2>Router and Consumer<a class="headerlink" href="#router-and-consumer" title="Link to this heading">¶</a></h2>
<p>To show how a slightly more complex case would work, consider a case
where a meta-estimator uses some metadata, but it also routes them to an
underlying estimator. In this case, this meta-estimator is a consumer and a
router at the same time. This is how we can implement one, and it is very
similar to what we had before, with a few tweaks.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">RouterConsumerClassifier</span><span class="p">(</span><a href="../../modules/generated/sklearn.base.MetaEstimatorMixin.html#sklearn.base.MetaEstimatorMixin" title="sklearn.base.MetaEstimatorMixin" class="sphx-glr-backref-module-sklearn-base sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">MetaEstimatorMixin</span></a><span class="p">,</span> <a href="../../modules/generated/sklearn.base.ClassifierMixin.html#sklearn.base.ClassifierMixin" title="sklearn.base.ClassifierMixin" class="sphx-glr-backref-module-sklearn-base sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ClassifierMixin</span></a><span class="p">,</span> <a href="../../modules/generated/sklearn.base.BaseEstimator.html#sklearn.base.BaseEstimator" title="sklearn.base.BaseEstimator" class="sphx-glr-backref-module-sklearn-base sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">BaseEstimator</span></a><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">estimator</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">estimator</span> <span class="o">=</span> <span class="n">estimator</span>

    <span class="k">def</span> <span class="nf">get_metadata_routing</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">router</span> <span class="o">=</span> <span class="p">(</span>
            <a href="../../modules/generated/sklearn.utils.metadata_routing.MetadataRouter.html#sklearn.utils.metadata_routing.MetadataRouter" title="sklearn.utils.metadata_routing.MetadataRouter" class="sphx-glr-backref-module-sklearn-utils-metadata_routing sphx-glr-backref-type-py-function"><span class="n">MetadataRouter</span></a><span class="p">(</span><span class="n">owner</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
            <span class="o">.</span><span class="n">add_self_request</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="p">,</span> <span class="n">method_mapping</span><span class="o">=</span><span class="s2">&quot;one-to-one&quot;</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">router</span>

    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">sample_weight</span><span class="p">,</span> <span class="o">**</span><span class="n">fit_params</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">estimator</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;estimator cannot be None!&quot;</span><span class="p">)</span>

        <span class="n">check_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sample_weight</span><span class="o">=</span><span class="n">sample_weight</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">sample_weight</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fit_params</span><span class="p">[</span><span class="s2">&quot;sample_weight&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sample_weight</span>

        <span class="c1"># meta-estimators are responsible for validating the given metadata</span>
        <span class="n">request_router</span> <span class="o">=</span> <a href="../../modules/generated/sklearn.utils.metadata_routing.get_routing_for_object.html#sklearn.utils.metadata_routing.get_routing_for_object" title="sklearn.utils.metadata_routing.get_routing_for_object" class="sphx-glr-backref-module-sklearn-utils-metadata_routing sphx-glr-backref-type-py-function"><span class="n">get_routing_for_object</span></a><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">request_router</span><span class="o">.</span><span class="n">validate_metadata</span><span class="p">(</span><span class="n">params</span><span class="o">=</span><span class="n">fit_params</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;fit&quot;</span><span class="p">)</span>
        <span class="c1"># we can use provided utility methods to map the given metadata to what</span>
        <span class="c1"># is required by the underlying estimator</span>
        <span class="n">params</span> <span class="o">=</span> <span class="n">request_router</span><span class="o">.</span><span class="n">route_params</span><span class="p">(</span><span class="n">params</span><span class="o">=</span><span class="n">fit_params</span><span class="p">,</span> <span class="n">caller</span><span class="o">=</span><span class="s2">&quot;fit&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">estimator_</span> <span class="o">=</span> <span class="n">clone</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">fit</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">classes_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">estimator_</span><span class="o">.</span><span class="n">classes_</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="o">**</span><span class="n">predict_params</span><span class="p">):</span>
        <a href="../../modules/generated/sklearn.utils.validation.check_is_fitted.html#sklearn.utils.validation.check_is_fitted" title="sklearn.utils.validation.check_is_fitted" class="sphx-glr-backref-module-sklearn-utils-validation sphx-glr-backref-type-py-function"><span class="n">check_is_fitted</span></a><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="c1"># same as in ``fit``, we validate the given metadata</span>
        <span class="n">request_router</span> <span class="o">=</span> <a href="../../modules/generated/sklearn.utils.metadata_routing.get_routing_for_object.html#sklearn.utils.metadata_routing.get_routing_for_object" title="sklearn.utils.metadata_routing.get_routing_for_object" class="sphx-glr-backref-module-sklearn-utils-metadata_routing sphx-glr-backref-type-py-function"><span class="n">get_routing_for_object</span></a><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">request_router</span><span class="o">.</span><span class="n">validate_metadata</span><span class="p">(</span><span class="n">params</span><span class="o">=</span><span class="n">predict_params</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;predict&quot;</span><span class="p">)</span>
        <span class="c1"># and then prepare the input to the underlying ``predict`` method.</span>
        <span class="n">params</span> <span class="o">=</span> <span class="n">request_router</span><span class="o">.</span><span class="n">route_params</span><span class="p">(</span><span class="n">params</span><span class="o">=</span><span class="n">predict_params</span><span class="p">,</span> <span class="n">caller</span><span class="o">=</span><span class="s2">&quot;predict&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">estimator_</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">predict</span><span class="p">)</span>
</pre></div>
</div>
<p>The key parts where the above estimator differs from our previous
meta-estimator is accepting <code class="docutils literal notranslate"><span class="pre">sample_weight</span></code> explicitly in <code class="docutils literal notranslate"><span class="pre">fit</span></code> and
including it in <code class="docutils literal notranslate"><span class="pre">fit_params</span></code>. Making <code class="docutils literal notranslate"><span class="pre">sample_weight</span></code> an explicit argument
makes sure <code class="docutils literal notranslate"><span class="pre">set_fit_request(sample_weight=...)</span></code> is present for this class.
In a sense, this means the estimator is both a consumer, as well as a router
of <code class="docutils literal notranslate"><span class="pre">sample_weight</span></code>.</p>
<p>In <code class="docutils literal notranslate"><span class="pre">get_metadata_routing</span></code>, we add <code class="docutils literal notranslate"><span class="pre">self</span></code> to the routing using
<code class="docutils literal notranslate"><span class="pre">add_self_request</span></code> to indicate this estimator is consuming
<code class="docutils literal notranslate"><span class="pre">sample_weight</span></code> as well as being a router; which also adds a
<code class="docutils literal notranslate"><span class="pre">$self_request</span></code> key to the routing info as illustrated below. Now let’s
look at some examples:</p>
<ul class="simple">
<li><p>No metadata requested</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">est</span> <span class="o">=</span> <span class="n">RouterConsumerClassifier</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">ExampleClassifier</span><span class="p">())</span>
<span class="n">print_routing</span><span class="p">(</span><span class="n">est</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>{&#39;$self_request&#39;: {&#39;fit&#39;: {&#39;sample_weight&#39;: None},
                   &#39;score&#39;: {&#39;sample_weight&#39;: None}},
 &#39;estimator&#39;: {&#39;mapping&#39;: [{&#39;callee&#39;: &#39;fit&#39;, &#39;caller&#39;: &#39;fit&#39;},
                           {&#39;callee&#39;: &#39;partial_fit&#39;, &#39;caller&#39;: &#39;partial_fit&#39;},
                           {&#39;callee&#39;: &#39;predict&#39;, &#39;caller&#39;: &#39;predict&#39;},
                           {&#39;callee&#39;: &#39;predict_proba&#39;,
                            &#39;caller&#39;: &#39;predict_proba&#39;},
                           {&#39;callee&#39;: &#39;predict_log_proba&#39;,
                            &#39;caller&#39;: &#39;predict_log_proba&#39;},
                           {&#39;callee&#39;: &#39;decision_function&#39;,
                            &#39;caller&#39;: &#39;decision_function&#39;},
                           {&#39;callee&#39;: &#39;score&#39;, &#39;caller&#39;: &#39;score&#39;},
                           {&#39;callee&#39;: &#39;split&#39;, &#39;caller&#39;: &#39;split&#39;},
                           {&#39;callee&#39;: &#39;transform&#39;, &#39;caller&#39;: &#39;transform&#39;},
                           {&#39;callee&#39;: &#39;inverse_transform&#39;,
                            &#39;caller&#39;: &#39;inverse_transform&#39;}],
               &#39;router&#39;: {&#39;fit&#39;: {&#39;sample_weight&#39;: None},
                          &#39;predict&#39;: {&#39;groups&#39;: None},
                          &#39;score&#39;: {&#39;sample_weight&#39;: None}}}}
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">sample_weight</span></code> requested by underlying estimator</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">est</span> <span class="o">=</span> <span class="n">RouterConsumerClassifier</span><span class="p">(</span>
    <span class="n">estimator</span><span class="o">=</span><span class="n">ExampleClassifier</span><span class="p">()</span><span class="o">.</span><span class="n">set_fit_request</span><span class="p">(</span><span class="n">sample_weight</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">print_routing</span><span class="p">(</span><span class="n">est</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>{&#39;$self_request&#39;: {&#39;fit&#39;: {&#39;sample_weight&#39;: None},
                   &#39;score&#39;: {&#39;sample_weight&#39;: None}},
 &#39;estimator&#39;: {&#39;mapping&#39;: [{&#39;callee&#39;: &#39;fit&#39;, &#39;caller&#39;: &#39;fit&#39;},
                           {&#39;callee&#39;: &#39;partial_fit&#39;, &#39;caller&#39;: &#39;partial_fit&#39;},
                           {&#39;callee&#39;: &#39;predict&#39;, &#39;caller&#39;: &#39;predict&#39;},
                           {&#39;callee&#39;: &#39;predict_proba&#39;,
                            &#39;caller&#39;: &#39;predict_proba&#39;},
                           {&#39;callee&#39;: &#39;predict_log_proba&#39;,
                            &#39;caller&#39;: &#39;predict_log_proba&#39;},
                           {&#39;callee&#39;: &#39;decision_function&#39;,
                            &#39;caller&#39;: &#39;decision_function&#39;},
                           {&#39;callee&#39;: &#39;score&#39;, &#39;caller&#39;: &#39;score&#39;},
                           {&#39;callee&#39;: &#39;split&#39;, &#39;caller&#39;: &#39;split&#39;},
                           {&#39;callee&#39;: &#39;transform&#39;, &#39;caller&#39;: &#39;transform&#39;},
                           {&#39;callee&#39;: &#39;inverse_transform&#39;,
                            &#39;caller&#39;: &#39;inverse_transform&#39;}],
               &#39;router&#39;: {&#39;fit&#39;: {&#39;sample_weight&#39;: True},
                          &#39;predict&#39;: {&#39;groups&#39;: None},
                          &#39;score&#39;: {&#39;sample_weight&#39;: None}}}}
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">sample_weight</span></code> requested by meta-estimator</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">est</span> <span class="o">=</span> <span class="n">RouterConsumerClassifier</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">ExampleClassifier</span><span class="p">())</span><span class="o">.</span><span class="n">set_fit_request</span><span class="p">(</span>
    <span class="n">sample_weight</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="n">print_routing</span><span class="p">(</span><span class="n">est</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>{&#39;$self_request&#39;: {&#39;fit&#39;: {&#39;sample_weight&#39;: True},
                   &#39;score&#39;: {&#39;sample_weight&#39;: None}},
 &#39;estimator&#39;: {&#39;mapping&#39;: [{&#39;callee&#39;: &#39;fit&#39;, &#39;caller&#39;: &#39;fit&#39;},
                           {&#39;callee&#39;: &#39;partial_fit&#39;, &#39;caller&#39;: &#39;partial_fit&#39;},
                           {&#39;callee&#39;: &#39;predict&#39;, &#39;caller&#39;: &#39;predict&#39;},
                           {&#39;callee&#39;: &#39;predict_proba&#39;,
                            &#39;caller&#39;: &#39;predict_proba&#39;},
                           {&#39;callee&#39;: &#39;predict_log_proba&#39;,
                            &#39;caller&#39;: &#39;predict_log_proba&#39;},
                           {&#39;callee&#39;: &#39;decision_function&#39;,
                            &#39;caller&#39;: &#39;decision_function&#39;},
                           {&#39;callee&#39;: &#39;score&#39;, &#39;caller&#39;: &#39;score&#39;},
                           {&#39;callee&#39;: &#39;split&#39;, &#39;caller&#39;: &#39;split&#39;},
                           {&#39;callee&#39;: &#39;transform&#39;, &#39;caller&#39;: &#39;transform&#39;},
                           {&#39;callee&#39;: &#39;inverse_transform&#39;,
                            &#39;caller&#39;: &#39;inverse_transform&#39;}],
               &#39;router&#39;: {&#39;fit&#39;: {&#39;sample_weight&#39;: None},
                          &#39;predict&#39;: {&#39;groups&#39;: None},
                          &#39;score&#39;: {&#39;sample_weight&#39;: None}}}}
</pre></div>
</div>
<p>Note the difference in the requested metadata representations above.</p>
<ul class="simple">
<li><p>We can also alias the metadata to pass different values to them:</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">est</span> <span class="o">=</span> <span class="n">RouterConsumerClassifier</span><span class="p">(</span>
    <span class="n">estimator</span><span class="o">=</span><span class="n">ExampleClassifier</span><span class="p">()</span><span class="o">.</span><span class="n">set_fit_request</span><span class="p">(</span><span class="n">sample_weight</span><span class="o">=</span><span class="s2">&quot;clf_sample_weight&quot;</span><span class="p">),</span>
<span class="p">)</span><span class="o">.</span><span class="n">set_fit_request</span><span class="p">(</span><span class="n">sample_weight</span><span class="o">=</span><span class="s2">&quot;meta_clf_sample_weight&quot;</span><span class="p">)</span>
<span class="n">print_routing</span><span class="p">(</span><span class="n">est</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>{&#39;$self_request&#39;: {&#39;fit&#39;: {&#39;sample_weight&#39;: &#39;meta_clf_sample_weight&#39;},
                   &#39;score&#39;: {&#39;sample_weight&#39;: None}},
 &#39;estimator&#39;: {&#39;mapping&#39;: [{&#39;callee&#39;: &#39;fit&#39;, &#39;caller&#39;: &#39;fit&#39;},
                           {&#39;callee&#39;: &#39;partial_fit&#39;, &#39;caller&#39;: &#39;partial_fit&#39;},
                           {&#39;callee&#39;: &#39;predict&#39;, &#39;caller&#39;: &#39;predict&#39;},
                           {&#39;callee&#39;: &#39;predict_proba&#39;,
                            &#39;caller&#39;: &#39;predict_proba&#39;},
                           {&#39;callee&#39;: &#39;predict_log_proba&#39;,
                            &#39;caller&#39;: &#39;predict_log_proba&#39;},
                           {&#39;callee&#39;: &#39;decision_function&#39;,
                            &#39;caller&#39;: &#39;decision_function&#39;},
                           {&#39;callee&#39;: &#39;score&#39;, &#39;caller&#39;: &#39;score&#39;},
                           {&#39;callee&#39;: &#39;split&#39;, &#39;caller&#39;: &#39;split&#39;},
                           {&#39;callee&#39;: &#39;transform&#39;, &#39;caller&#39;: &#39;transform&#39;},
                           {&#39;callee&#39;: &#39;inverse_transform&#39;,
                            &#39;caller&#39;: &#39;inverse_transform&#39;}],
               &#39;router&#39;: {&#39;fit&#39;: {&#39;sample_weight&#39;: &#39;clf_sample_weight&#39;},
                          &#39;predict&#39;: {&#39;groups&#39;: None},
                          &#39;score&#39;: {&#39;sample_weight&#39;: None}}}}
</pre></div>
</div>
<p>However, <code class="docutils literal notranslate"><span class="pre">fit</span></code> of the meta-estimator only needs the alias for the
sub-estimator, since it doesn’t validate and route its own required metadata:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">est</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">sample_weight</span><span class="o">=</span><span class="n">my_weights</span><span class="p">,</span> <span class="n">clf_sample_weight</span><span class="o">=</span><span class="n">my_other_weights</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Received sample_weight of length = 100 in RouterConsumerClassifier.
Received sample_weight of length = 100 in ExampleClassifier.
</pre></div>
</div>
<div class="output_subarea output_html rendered_html output_result">
<style>#sk-container-id-51 {color: black;}#sk-container-id-51 pre{padding: 0;}#sk-container-id-51 div.sk-toggleable {background-color: white;}#sk-container-id-51 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-51 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-51 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-51 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-51 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-51 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-51 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-51 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-51 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-51 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-51 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-51 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-51 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-51 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-51 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-51 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-51 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-51 div.sk-item {position: relative;z-index: 1;}#sk-container-id-51 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-51 div.sk-item::before, #sk-container-id-51 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-51 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-51 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-51 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-51 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-51 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-51 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-51 div.sk-label-container {text-align: center;}#sk-container-id-51 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-51 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-51" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>RouterConsumerClassifier(estimator=ExampleClassifier())</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-225" type="checkbox" ><label for="sk-estimator-id-225" class="sk-toggleable__label sk-toggleable__label-arrow">RouterConsumerClassifier</label><div class="sk-toggleable__content"><pre>RouterConsumerClassifier(estimator=ExampleClassifier())</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-226" type="checkbox" ><label for="sk-estimator-id-226" class="sk-toggleable__label sk-toggleable__label-arrow">estimator: ExampleClassifier</label><div class="sk-toggleable__content"><pre>ExampleClassifier()</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-227" type="checkbox" ><label for="sk-estimator-id-227" class="sk-toggleable__label sk-toggleable__label-arrow">ExampleClassifier</label><div class="sk-toggleable__content"><pre>ExampleClassifier()</pre></div></div></div></div></div></div></div></div></div></div>
</div>
<br />
<br /><ul class="simple">
<li><p>Alias only on the sub-estimator. This is useful if we don’t want the
meta-estimator to use the metadata, and we only want the metadata to be used
by the sub-estimator.</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">est</span> <span class="o">=</span> <span class="n">RouterConsumerClassifier</span><span class="p">(</span>
    <span class="n">estimator</span><span class="o">=</span><span class="n">ExampleClassifier</span><span class="p">()</span><span class="o">.</span><span class="n">set_fit_request</span><span class="p">(</span><span class="n">sample_weight</span><span class="o">=</span><span class="s2">&quot;aliased_sample_weight&quot;</span><span class="p">)</span>
<span class="p">)</span><span class="o">.</span><span class="n">set_fit_request</span><span class="p">(</span><span class="n">sample_weight</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">print_routing</span><span class="p">(</span><span class="n">est</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>{&#39;$self_request&#39;: {&#39;fit&#39;: {&#39;sample_weight&#39;: True},
                   &#39;score&#39;: {&#39;sample_weight&#39;: None}},
 &#39;estimator&#39;: {&#39;mapping&#39;: [{&#39;callee&#39;: &#39;fit&#39;, &#39;caller&#39;: &#39;fit&#39;},
                           {&#39;callee&#39;: &#39;partial_fit&#39;, &#39;caller&#39;: &#39;partial_fit&#39;},
                           {&#39;callee&#39;: &#39;predict&#39;, &#39;caller&#39;: &#39;predict&#39;},
                           {&#39;callee&#39;: &#39;predict_proba&#39;,
                            &#39;caller&#39;: &#39;predict_proba&#39;},
                           {&#39;callee&#39;: &#39;predict_log_proba&#39;,
                            &#39;caller&#39;: &#39;predict_log_proba&#39;},
                           {&#39;callee&#39;: &#39;decision_function&#39;,
                            &#39;caller&#39;: &#39;decision_function&#39;},
                           {&#39;callee&#39;: &#39;score&#39;, &#39;caller&#39;: &#39;score&#39;},
                           {&#39;callee&#39;: &#39;split&#39;, &#39;caller&#39;: &#39;split&#39;},
                           {&#39;callee&#39;: &#39;transform&#39;, &#39;caller&#39;: &#39;transform&#39;},
                           {&#39;callee&#39;: &#39;inverse_transform&#39;,
                            &#39;caller&#39;: &#39;inverse_transform&#39;}],
               &#39;router&#39;: {&#39;fit&#39;: {&#39;sample_weight&#39;: &#39;aliased_sample_weight&#39;},
                          &#39;predict&#39;: {&#39;groups&#39;: None},
                          &#39;score&#39;: {&#39;sample_weight&#39;: None}}}}
</pre></div>
</div>
</section>
<section id="simple-pipeline">
<h2>Simple Pipeline<a class="headerlink" href="#simple-pipeline" title="Link to this heading">¶</a></h2>
<p>A slightly more complicated use-case is a meta-estimator which does something
similar to the <a class="reference internal" href="../../modules/generated/sklearn.pipeline.Pipeline.html#sklearn.pipeline.Pipeline" title="sklearn.pipeline.Pipeline"><code class="xref py py-class docutils literal notranslate"><span class="pre">Pipeline</span></code></a>. Here is a meta-estimator, which
accepts a transformer and a classifier, and applies the transformer before
running the classifier.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">SimplePipeline</span><span class="p">(</span><a href="../../modules/generated/sklearn.base.ClassifierMixin.html#sklearn.base.ClassifierMixin" title="sklearn.base.ClassifierMixin" class="sphx-glr-backref-module-sklearn-base sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ClassifierMixin</span></a><span class="p">,</span> <a href="../../modules/generated/sklearn.base.BaseEstimator.html#sklearn.base.BaseEstimator" title="sklearn.base.BaseEstimator" class="sphx-glr-backref-module-sklearn-base sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">BaseEstimator</span></a><span class="p">):</span>
    <span class="n">_required_parameters</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;estimator&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">transformer</span><span class="p">,</span> <span class="n">classifier</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transformer</span> <span class="o">=</span> <span class="n">transformer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">classifier</span> <span class="o">=</span> <span class="n">classifier</span>

    <span class="k">def</span> <span class="nf">get_metadata_routing</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">router</span> <span class="o">=</span> <span class="p">(</span>
            <a href="../../modules/generated/sklearn.utils.metadata_routing.MetadataRouter.html#sklearn.utils.metadata_routing.MetadataRouter" title="sklearn.utils.metadata_routing.MetadataRouter" class="sphx-glr-backref-module-sklearn-utils-metadata_routing sphx-glr-backref-type-py-function"><span class="n">MetadataRouter</span></a><span class="p">(</span><span class="n">owner</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
            <span class="o">.</span><span class="n">add</span><span class="p">(</span>
                <span class="n">transformer</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">transformer</span><span class="p">,</span>
                <span class="n">method_mapping</span><span class="o">=</span><a href="../../modules/generated/sklearn.utils.metadata_routing.MethodMapping.html#sklearn.utils.metadata_routing.MethodMapping" title="sklearn.utils.metadata_routing.MethodMapping" class="sphx-glr-backref-module-sklearn-utils-metadata_routing sphx-glr-backref-type-py-function"><span class="n">MethodMapping</span></a><span class="p">()</span>
                <span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">callee</span><span class="o">=</span><span class="s2">&quot;fit&quot;</span><span class="p">,</span> <span class="n">caller</span><span class="o">=</span><span class="s2">&quot;fit&quot;</span><span class="p">)</span>
                <span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">callee</span><span class="o">=</span><span class="s2">&quot;transform&quot;</span><span class="p">,</span> <span class="n">caller</span><span class="o">=</span><span class="s2">&quot;fit&quot;</span><span class="p">)</span>
                <span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">callee</span><span class="o">=</span><span class="s2">&quot;transform&quot;</span><span class="p">,</span> <span class="n">caller</span><span class="o">=</span><span class="s2">&quot;predict&quot;</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">classifier</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">classifier</span><span class="p">,</span> <span class="n">method_mapping</span><span class="o">=</span><span class="s2">&quot;one-to-one&quot;</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">router</span>

    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="o">**</span><span class="n">fit_params</span><span class="p">):</span>
        <span class="n">params</span> <span class="o">=</span> <a href="../../modules/generated/sklearn.utils.metadata_routing.process_routing.html#sklearn.utils.metadata_routing.process_routing" title="sklearn.utils.metadata_routing.process_routing" class="sphx-glr-backref-module-sklearn-utils-metadata_routing sphx-glr-backref-type-py-function"><span class="n">process_routing</span></a><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;fit&quot;</span><span class="p">,</span> <span class="n">fit_params</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">transformer_</span> <span class="o">=</span> <span class="n">clone</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">transformer</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="o">.</span><span class="n">transformer</span><span class="o">.</span><span class="n">fit</span><span class="p">)</span>
        <span class="n">X_transformed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transformer_</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="o">.</span><span class="n">transformer</span><span class="o">.</span><span class="n">transform</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">classifier_</span> <span class="o">=</span> <span class="n">clone</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">classifier</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span>
            <span class="n">X_transformed</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="o">.</span><span class="n">classifier</span><span class="o">.</span><span class="n">fit</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="o">**</span><span class="n">predict_params</span><span class="p">):</span>
        <span class="n">params</span> <span class="o">=</span> <a href="../../modules/generated/sklearn.utils.metadata_routing.process_routing.html#sklearn.utils.metadata_routing.process_routing" title="sklearn.utils.metadata_routing.process_routing" class="sphx-glr-backref-module-sklearn-utils-metadata_routing sphx-glr-backref-type-py-function"><span class="n">process_routing</span></a><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;predict&quot;</span><span class="p">,</span> <span class="n">predict_params</span><span class="p">)</span>

        <span class="n">X_transformed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transformer_</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="o">.</span><span class="n">transformer</span><span class="o">.</span><span class="n">transform</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">classifier_</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_transformed</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="o">.</span><span class="n">classifier</span><span class="o">.</span><span class="n">predict</span><span class="p">)</span>
</pre></div>
</div>
<p>Note the usage of <a class="reference internal" href="../../modules/generated/sklearn.utils.metadata_routing.MethodMapping.html#sklearn.utils.metadata_routing.MethodMapping" title="sklearn.utils.metadata_routing.MethodMapping"><code class="xref py py-class docutils literal notranslate"><span class="pre">MethodMapping</span></code></a> to declare
which methods of the child estimator (callee) are used in which methods of
the meta estimator (caller). As you can see, we use the transformer’s
<code class="docutils literal notranslate"><span class="pre">transform</span></code> and <code class="docutils literal notranslate"><span class="pre">fit</span></code> methods in <code class="docutils literal notranslate"><span class="pre">fit</span></code>, and its <code class="docutils literal notranslate"><span class="pre">transform</span></code> method in
<code class="docutils literal notranslate"><span class="pre">predict</span></code>, and that’s what you see implemented in the routing structure of
the pipeline class.</p>
<p>Another difference in the above example with the previous ones is the usage
of <a class="reference internal" href="../../modules/generated/sklearn.utils.metadata_routing.process_routing.html#sklearn.utils.metadata_routing.process_routing" title="sklearn.utils.metadata_routing.process_routing"><code class="xref py py-func docutils literal notranslate"><span class="pre">process_routing</span></code></a>, which processes the input
parameters, does the required validation, and returns the <code class="docutils literal notranslate"><span class="pre">params</span></code> which we
had created in previous examples. This reduces the boilerplate code a
developer needs to write in each meta-estimator’s method. Developers are
strongly recommended to use this function unless there is a good reason
against it.</p>
<p>In order to test the above pipeline, let’s add an example transformer.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ExampleTransformer</span><span class="p">(</span><a href="../../modules/generated/sklearn.base.TransformerMixin.html#sklearn.base.TransformerMixin" title="sklearn.base.TransformerMixin" class="sphx-glr-backref-module-sklearn-base sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">TransformerMixin</span></a><span class="p">,</span> <a href="../../modules/generated/sklearn.base.BaseEstimator.html#sklearn.base.BaseEstimator" title="sklearn.base.BaseEstimator" class="sphx-glr-backref-module-sklearn-base sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">BaseEstimator</span></a><span class="p">):</span>
    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">sample_weight</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">check_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sample_weight</span><span class="o">=</span><span class="n">sample_weight</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">groups</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">check_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">groups</span><span class="o">=</span><span class="n">groups</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">X</span>
</pre></div>
</div>
<p>Now we can test our pipeline, and see if metadata is correctly passed around.
This example uses our simple pipeline, and our transformer, and our
consumer+router estimator which uses our simple classifier.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">est</span> <span class="o">=</span> <span class="n">SimplePipeline</span><span class="p">(</span>
    <span class="n">transformer</span><span class="o">=</span><span class="n">ExampleTransformer</span><span class="p">()</span>
    <span class="c1"># we transformer&#39;s fit to receive sample_weight</span>
    <span class="o">.</span><span class="n">set_fit_request</span><span class="p">(</span><span class="n">sample_weight</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># we want transformer&#39;s transform to receive groups</span>
    <span class="o">.</span><span class="n">set_transform_request</span><span class="p">(</span><span class="n">groups</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="n">classifier</span><span class="o">=</span><span class="n">RouterConsumerClassifier</span><span class="p">(</span>
        <span class="n">estimator</span><span class="o">=</span><span class="n">ExampleClassifier</span><span class="p">()</span>
        <span class="c1"># we want this sub-estimator to receive sample_weight in fit</span>
        <span class="o">.</span><span class="n">set_fit_request</span><span class="p">(</span><span class="n">sample_weight</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># but not groups in predict</span>
        <span class="o">.</span><span class="n">set_predict_request</span><span class="p">(</span><span class="n">groups</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
    <span class="p">)</span><span class="o">.</span><span class="n">set_fit_request</span><span class="p">(</span>
        <span class="c1"># and we want the meta-estimator to receive sample_weight as well</span>
        <span class="n">sample_weight</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">),</span>
<span class="p">)</span>
<span class="n">est</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">sample_weight</span><span class="o">=</span><span class="n">my_weights</span><span class="p">,</span> <span class="n">groups</span><span class="o">=</span><span class="n">my_groups</span><span class="p">)</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span>
    <span class="n">X</span><span class="p">[:</span><span class="mi">3</span><span class="p">],</span> <span class="n">groups</span><span class="o">=</span><span class="n">my_groups</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Received sample_weight of length = 100 in ExampleTransformer.
Received groups of length = 100 in ExampleTransformer.
Received sample_weight of length = 100 in RouterConsumerClassifier.
Received sample_weight of length = 100 in ExampleClassifier.
Received groups of length = 100 in ExampleTransformer.
groups is None in ExampleClassifier.

array([1., 1., 1.])
</pre></div>
</div>
</section>
<section id="deprecation-default-value-change">
<h2>Deprecation / Default Value Change<a class="headerlink" href="#deprecation-default-value-change" title="Link to this heading">¶</a></h2>
<p>In this section we show how one should handle the case where a router becomes
also a consumer, especially when it consumes the same metadata as its
sub-estimator, or a consumer starts consuming a metadata which it wasn’t in
an older release. In this case, a warning should be raised for a while, to
let users know the behavior is changed from previous versions.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MetaRegressor</span><span class="p">(</span><a href="../../modules/generated/sklearn.base.MetaEstimatorMixin.html#sklearn.base.MetaEstimatorMixin" title="sklearn.base.MetaEstimatorMixin" class="sphx-glr-backref-module-sklearn-base sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">MetaEstimatorMixin</span></a><span class="p">,</span> <a href="../../modules/generated/sklearn.base.RegressorMixin.html#sklearn.base.RegressorMixin" title="sklearn.base.RegressorMixin" class="sphx-glr-backref-module-sklearn-base sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">RegressorMixin</span></a><span class="p">,</span> <a href="../../modules/generated/sklearn.base.BaseEstimator.html#sklearn.base.BaseEstimator" title="sklearn.base.BaseEstimator" class="sphx-glr-backref-module-sklearn-base sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">BaseEstimator</span></a><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">estimator</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">estimator</span> <span class="o">=</span> <span class="n">estimator</span>

    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="o">**</span><span class="n">fit_params</span><span class="p">):</span>
        <span class="n">params</span> <span class="o">=</span> <a href="../../modules/generated/sklearn.utils.metadata_routing.process_routing.html#sklearn.utils.metadata_routing.process_routing" title="sklearn.utils.metadata_routing.process_routing" class="sphx-glr-backref-module-sklearn-utils-metadata_routing sphx-glr-backref-type-py-function"><span class="n">process_routing</span></a><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;fit&quot;</span><span class="p">,</span> <span class="n">fit_params</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">estimator_</span> <span class="o">=</span> <span class="n">clone</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">fit</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_metadata_routing</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">router</span> <span class="o">=</span> <a href="../../modules/generated/sklearn.utils.metadata_routing.MetadataRouter.html#sklearn.utils.metadata_routing.MetadataRouter" title="sklearn.utils.metadata_routing.MetadataRouter" class="sphx-glr-backref-module-sklearn-utils-metadata_routing sphx-glr-backref-type-py-function"><span class="n">MetadataRouter</span></a><span class="p">(</span><span class="n">owner</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
            <span class="n">estimator</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="p">,</span> <span class="n">method_mapping</span><span class="o">=</span><span class="s2">&quot;one-to-one&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">router</span>
</pre></div>
</div>
<p>As explained above, this is now a valid usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">reg</span> <span class="o">=</span> <span class="n">MetaRegressor</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><a href="../../modules/generated/sklearn.linear_model.LinearRegression.html#sklearn.linear_model.LinearRegression" title="sklearn.linear_model.LinearRegression" class="sphx-glr-backref-module-sklearn-linear_model sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">LinearRegression</span></a><span class="p">()</span><span class="o">.</span><span class="n">set_fit_request</span><span class="p">(</span><span class="n">sample_weight</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<span class="n">reg</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">sample_weight</span><span class="o">=</span><span class="n">my_weights</span><span class="p">)</span>
</pre></div>
</div>
<p>Now imagine we further develop <code class="docutils literal notranslate"><span class="pre">MetaRegressor</span></code> and it now also <em>consumes</em>
<code class="docutils literal notranslate"><span class="pre">sample_weight</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">WeightedMetaRegressor</span><span class="p">(</span><a href="../../modules/generated/sklearn.base.MetaEstimatorMixin.html#sklearn.base.MetaEstimatorMixin" title="sklearn.base.MetaEstimatorMixin" class="sphx-glr-backref-module-sklearn-base sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">MetaEstimatorMixin</span></a><span class="p">,</span> <a href="../../modules/generated/sklearn.base.RegressorMixin.html#sklearn.base.RegressorMixin" title="sklearn.base.RegressorMixin" class="sphx-glr-backref-module-sklearn-base sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">RegressorMixin</span></a><span class="p">,</span> <a href="../../modules/generated/sklearn.base.BaseEstimator.html#sklearn.base.BaseEstimator" title="sklearn.base.BaseEstimator" class="sphx-glr-backref-module-sklearn-base sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">BaseEstimator</span></a><span class="p">):</span>
    <span class="n">__metadata_request__fit</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;sample_weight&quot;</span><span class="p">:</span> <span class="n">metadata_routing</span><span class="o">.</span><span class="n">WARN</span><span class="p">}</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">estimator</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">estimator</span> <span class="o">=</span> <span class="n">estimator</span>

    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">sample_weight</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">fit_params</span><span class="p">):</span>
        <span class="n">params</span> <span class="o">=</span> <a href="../../modules/generated/sklearn.utils.metadata_routing.process_routing.html#sklearn.utils.metadata_routing.process_routing" title="sklearn.utils.metadata_routing.process_routing" class="sphx-glr-backref-module-sklearn-utils-metadata_routing sphx-glr-backref-type-py-function"><span class="n">process_routing</span></a><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;fit&quot;</span><span class="p">,</span> <span class="n">fit_params</span><span class="p">,</span> <span class="n">sample_weight</span><span class="o">=</span><span class="n">sample_weight</span><span class="p">)</span>
        <span class="n">check_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sample_weight</span><span class="o">=</span><span class="n">sample_weight</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">estimator_</span> <span class="o">=</span> <span class="n">clone</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">fit</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_metadata_routing</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">router</span> <span class="o">=</span> <span class="p">(</span>
            <a href="../../modules/generated/sklearn.utils.metadata_routing.MetadataRouter.html#sklearn.utils.metadata_routing.MetadataRouter" title="sklearn.utils.metadata_routing.MetadataRouter" class="sphx-glr-backref-module-sklearn-utils-metadata_routing sphx-glr-backref-type-py-function"><span class="n">MetadataRouter</span></a><span class="p">(</span><span class="n">owner</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
            <span class="o">.</span><span class="n">add_self_request</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">estimator</span><span class="p">,</span> <span class="n">method_mapping</span><span class="o">=</span><span class="s2">&quot;one-to-one&quot;</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">router</span>
</pre></div>
</div>
<p>The above implementation is almost no different than <code class="docutils literal notranslate"><span class="pre">MetaRegressor</span></code>, and
because of the default request value defined in <code class="docutils literal notranslate"><span class="pre">__metadata_request__fit</span></code>
there is a warning raised.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <a href="https://docs.python.org/3/library/warnings.html#warnings.catch_warnings" title="warnings.catch_warnings" class="sphx-glr-backref-module-warnings sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span></a><span class="p">(</span><span class="n">record</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">record</span><span class="p">:</span>
    <span class="n">WeightedMetaRegressor</span><span class="p">(</span>
        <span class="n">estimator</span><span class="o">=</span><a href="../../modules/generated/sklearn.linear_model.LinearRegression.html#sklearn.linear_model.LinearRegression" title="sklearn.linear_model.LinearRegression" class="sphx-glr-backref-module-sklearn-linear_model sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">LinearRegression</span></a><span class="p">()</span><span class="o">.</span><span class="n">set_fit_request</span><span class="p">(</span><span class="n">sample_weight</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">sample_weight</span><span class="o">=</span><span class="n">my_weights</span><span class="p">)</span>
<span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">record</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">message</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Received sample_weight of length = 100 in WeightedMetaRegressor.
Support for sample_weight has recently been added to this class. To maintain backward compatibility, it is ignored now. You can set the request value to False to silence this warning, or to True to consume and use the metadata.
</pre></div>
</div>
<p>When an estimator supports a metadata which wasn’t supported before, the
following pattern can be used to warn the users about it.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ExampleRegressor</span><span class="p">(</span><a href="../../modules/generated/sklearn.base.RegressorMixin.html#sklearn.base.RegressorMixin" title="sklearn.base.RegressorMixin" class="sphx-glr-backref-module-sklearn-base sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">RegressorMixin</span></a><span class="p">,</span> <a href="../../modules/generated/sklearn.base.BaseEstimator.html#sklearn.base.BaseEstimator" title="sklearn.base.BaseEstimator" class="sphx-glr-backref-module-sklearn-base sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">BaseEstimator</span></a><span class="p">):</span>
    <span class="n">__metadata_request__fit</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;sample_weight&quot;</span><span class="p">:</span> <span class="n">metadata_routing</span><span class="o">.</span><span class="n">WARN</span><span class="p">}</span>

    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">sample_weight</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">check_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sample_weight</span><span class="o">=</span><span class="n">sample_weight</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
        <span class="k">return</span> <a href="https://numpy.org/doc/stable/reference/generated/numpy.zeros.html#numpy.zeros" title="numpy.zeros" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-py-function"><span class="n">np</span><span class="o">.</span><span class="n">zeros</span></a><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)))</span>


<span class="k">with</span> <a href="https://docs.python.org/3/library/warnings.html#warnings.catch_warnings" title="warnings.catch_warnings" class="sphx-glr-backref-module-warnings sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span></a><span class="p">(</span><span class="n">record</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">record</span><span class="p">:</span>
    <span class="n">MetaRegressor</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">ExampleRegressor</span><span class="p">())</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">sample_weight</span><span class="o">=</span><span class="n">my_weights</span><span class="p">)</span>
<span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">record</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">message</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>sample_weight is None in ExampleRegressor.
Support for sample_weight has recently been added to this class. To maintain backward compatibility, it is ignored now. You can set the request value to False to silence this warning, or to True to consume and use the metadata.
</pre></div>
</div>
</section>
<section id="third-party-development-and-scikit-learn-dependency">
<h2>Third Party Development and scikit-learn Dependency<a class="headerlink" href="#third-party-development-and-scikit-learn-dependency" title="Link to this heading">¶</a></h2>
<p>As seen above, information is communicated between classes using
<a class="reference internal" href="../../modules/generated/sklearn.utils.metadata_routing.MetadataRequest.html#sklearn.utils.metadata_routing.MetadataRequest" title="sklearn.utils.metadata_routing.MetadataRequest"><code class="xref py py-class docutils literal notranslate"><span class="pre">MetadataRequest</span></code></a> and
<a class="reference internal" href="../../modules/generated/sklearn.utils.metadata_routing.MetadataRouter.html#sklearn.utils.metadata_routing.MetadataRouter" title="sklearn.utils.metadata_routing.MetadataRouter"><code class="xref py py-class docutils literal notranslate"><span class="pre">MetadataRouter</span></code></a>. It is strongly not advised,
but possible to vendor the tools related to metadata-routing if you strictly
want to have a scikit-learn compatible estimator, without depending on the
scikit-learn package. If the following conditions are met, you do NOT need to
modify your code at all:</p>
<ul class="simple">
<li><p>your estimator inherits from <a class="reference internal" href="../../modules/generated/sklearn.base.BaseEstimator.html#sklearn.base.BaseEstimator" title="sklearn.base.BaseEstimator"><code class="xref py py-class docutils literal notranslate"><span class="pre">BaseEstimator</span></code></a></p></li>
<li><p>the parameters consumed by your estimator’s methods, e.g. <code class="docutils literal notranslate"><span class="pre">fit</span></code>, are
explicitly defined in the method’s signature, as opposed to being
<code class="docutils literal notranslate"><span class="pre">*args</span></code> or <code class="docutils literal notranslate"><span class="pre">*kwargs</span></code>.</p></li>
<li><p>you do not route any metadata to the underlying objects, i.e. you’re not a
<em>router</em>.</p></li>
</ul>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> (0 minutes 0.029 seconds)</p>
<div class="sphx-glr-footer sphx-glr-footer-example docutils container" id="sphx-glr-download-auto-examples-miscellaneous-plot-metadata-routing-py">
<div class="binder-badge docutils container">
<a class="reference external image-reference" href="https://mybinder.org/v2/gh/scikit-learn/scikit-learn/1.3.X?urlpath=lab/tree/notebooks/auto_examples/miscellaneous/plot_metadata_routing.ipynb"><img alt="Launch binder" src="../../_images/binder_badge_logo20.svg" width="150px" /></a>
</div>
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/35686e86ab04c9899b73acd07be52bc7/plot_metadata_routing.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">plot_metadata_routing.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/64a4ce2171987c74f955483a03ac45b5/plot_metadata_routing.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">plot_metadata_routing.ipynb</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</section>
</section>


      </div>
    <div class="container">
      <footer class="sk-content-footer">
            &copy; 2007 - 2023, scikit-learn developers (BSD License).
          <a href="../../_sources/auto_examples/miscellaneous/plot_metadata_routing.rst.txt" rel="nofollow">Show this page source</a>
      </footer>
    </div>
  </div>
</div>
<script src="../../_static/js/vendor/bootstrap.min.js"></script>

<script>
    window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
    ga('create', 'UA-22606712-2', 'auto');
    ga('set', 'anonymizeIp', true);
    ga('send', 'pageview');
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>



<script defer data-domain="scikit-learn.org" src="https://views.scientific-python.org/js/script.js">
</script>


<script src="../../_static/clipboard.min.js"></script>
<script src="../../_static/copybutton.js"></script>

<script>
$(document).ready(function() {
    /* Add a [>>>] button on the top-right corner of code samples to hide
     * the >>> and ... prompts and the output and thus make the code
     * copyable. */
    var div = $('.highlight-python .highlight,' +
                '.highlight-python3 .highlight,' +
                '.highlight-pycon .highlight,' +
		'.highlight-default .highlight')
    var pre = div.find('pre');

    // get the styles from the current theme
    pre.parent().parent().css('position', 'relative');

    // create and add the button to all the code blocks that contain >>>
    div.each(function(index) {
        var jthis = $(this);
        // tracebacks (.gt) contain bare text elements that need to be
        // wrapped in a span to work with .nextUntil() (see later)
        jthis.find('pre:has(.gt)').contents().filter(function() {
            return ((this.nodeType == 3) && (this.data.trim().length > 0));
        }).wrap('<span>');
    });

	/*** Add permalink buttons next to glossary terms ***/
	$('dl.glossary > dt[id]').append(function() {
		return ('<a class="headerlink" href="#' +
			    this.getAttribute('id') +
			    '" title="Permalink to this term">¶</a>');
	});
});

</script>
    
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
    
</body>
</html>